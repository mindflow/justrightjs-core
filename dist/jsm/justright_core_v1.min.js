import{ContainerUrl as e,ContainerHttpClient as t,ContainerElement as s,ContainerWindow as i}from"./containerbridge_v1.js";import{List as n,Map as a,Logger as r,ObjectFunction as l,StringUtils as o,PropertyAccessor as h}from"./coreutil_v1.js";import{InjectionPoint as u,SingletonConfig as c,PrototypeConfig as d,MindiInjector as m,MindiConfig as p,InstancePostConfigTrigger as g,ConfigAccessor as f}from"./mindi_v1.js";import{XmlElement as v,XmlCdata as y,DomTree as w}from"./xmlparser_v1.js";class E{runModule(e){}}class b{constructor(e){if(this.protocol=null,this.host=null,this.port=null,this.pathList=new n,this.parameterMap=new a,this.bookmark=null,null!==e){var t=this.determineProtocol(e);null!==t&&(null!==this.protocol&&(t=this.determineHost(t)),null!==t&&(null!==this.host&&(t=this.determinePort(t)),null!==t&&null!==(t=this.determinePath(t))&&null!==(t=this.determineParameters(t))&&this.determineBookmark(t)))}}getProtocol(){return this.protocol}getHost(){return this.host}getPort(){return this.port}getPathList(){return this.pathList}getPathPart(e){return this.pathList.get(e)}getPath(){let e="/",t=!0;return this.pathList.forEach((s=>{t||(e+="/"),e+=s,t=!1}),this),e}clearPathList(){this.pathList=new n}getParameterMap(){return this.parameterMap}clearParameterMAp(){this.parameterMap=new a}getParameter(e){return this.parameterMap.get(e)}setParameter(e,t){this.parameterMap.set(e,t)}setBookmark(e){this.bookmark=e}setPath(e){this.determinePath(e)}setQueryString(e){this.parameterMap=this.determineParameters(e)}getBookmark(){return this.bookmark}determineProtocol(e){if(-1===e.indexOf("//"))return e;var t=e.split("//");return-1!==t[0].indexOf("/")?e:(this.protocol=t[0],1==t.length?null:e.replace(t[0]+"//",""))}determineHost(e){var t=e.split("/"),s=t[0];return-1!==s.indexOf(":")&&(s=s.split(":")[0]),this.host=s,t.length>1?e.replace(s,""):null}determinePort(e){if(!e.startsWith(":"))return e;var t=e.split("/")[0].substring(1);return this.port=t,e.replace(":"+t,"")}determinePath(e){var t=e;if(-1!==e.indexOf("?"))(s=e.split("?")).length>1&&(t=e.substring(e.indexOf("?"))),e=s[0];else if(-1!==e.indexOf("#")){var s;(s=e.split("#")).length>1&&(t=e.substring(e.indexOf("#"))),e=s[0]}e.startsWith("/")&&(e=e.substring(1));var i=new n(e.split("/"));return this.pathList=new n,i.forEach((function(e,t){return t.pathList.add(decodeURI(e)),!0}),this),t}determineParameters(e){var t=e;if(-1===e.indexOf("?"))return e;-1!==(e=e.substring(e.indexOf("?")+1)).indexOf("#")&&(t=e.substring(e.indexOf("#")),e=e.substring(0,e.indexOf("#")));var s=new n(e.split("&")),i=new a;return s.forEach((function(e,t){var s=e.split("=");return s.length>=2&&i.set(decodeURI(s[0]),decodeURI(s[1])),!0}),this),this.parameterMap=i,t}determineBookmark(e){-1!==e.indexOf("#")&&(this.bookmark=e.substring(e.indexOf("#")+1))}toString(){var e="";null!==this.protocol&&(e=e+this.protocol+"//"),null!==this.host&&(e+=this.host),null!==this.port&&(e=e+":"+this.port),this.pathList.forEach((function(t,s){return e=e+"/"+t,!0}),this);var t=!0;return this.parameterMap.forEach((function(s,i,n){t?(t=!1,e+="?"):e+="&",e=e+encodeURI(s)+"="+encodeURI(i)}),this),null!==this.bookmark&&(e=e+"#"+this.bookmark),e}}class M{static replaceUrl(t,s,i){e.replaceUrl(t.toString(),s,i)}static pushUrl(t,s,i){e.pushUrl(t.toString(),s,i)}static currentUrl(){return new b(e.currentUrl())}}let T=null;class C{constructor(){}static instance(){return T||(T=new C),T}go(e){ContainerUrl.go(e.toString())}back(){ContainerUrl.back()}load(e){const t=M.currentUrl();return t.determinePath(e),M.pushUrl(t),t}}let L=null;class S{constructor(){this.moduleRunner=null}static instance(){return L||(L=new S),L}set(e){this.moduleRunner=e}load(e){const t=C.instance().load(e);this.moduleRunner.runModule(t)}}class x{static get(e,s=4e3,i=4e3,n=null){var a={headers:x.getHeader(n),method:"GET",mode:"cors",redirect:"follow"};return t.fetch(e.toString(),a,s,i)}static post(e,s,i=4e3,n=4e3,a=null){let r=x.getHeader(a);var l={body:JSON.stringify(s),headers:r,method:"POST",mode:"cors",redirect:"follow"};return t.fetch(e.toString(),l,i,n)}static put(e,s,i=4e3,n=4e3,a=null){let r=x.getHeader(a);var l={body:JSON.stringify(s),method:"PUT",mode:"cors",redirect:"follow",headers:r};return t.fetch(e.toString(),l,i,n)}static patch(e,s,i=4e3,n=4e3,a=null){let r=x.getHeader(a);var l={body:JSON.stringify(s),method:"PATCH",mode:"cors",redirect:"follow",headers:r};return t.fetch(e.toString(),l,i,n)}static delete(e,s=4e3,i=4e3){return t.fetch(e.toString(),{method:"DELETE",mode:"cors",redirect:"follow"},s,i)}static getHeader(e=null){let t={"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"};return e&&(t={"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json",Authorization:e}),t}}class P{constructor(e){this.stylesSource=e}getStylesSource(){return this.stylesSource}}const k=new r("StylesRegistry");class R{constructor(){this.stylesMap=new a,this.stylesUrlMap=new a,this.stylesQueueSize=0,this.callback=null}set(e,t,s){null!=s&&this.stylesUrlMap.set(e,s),this.stylesMap.set(e,t)}get(e){return this.stylesMap.get(e)}contains(e){return this.stylesMap.contains(e)}done(e){this.callback=e,this.doCallback(this)}doCallback(e){if(null!==tmo.callback&&void 0!==e.callback&&e.stylesQueueSize===e.stylesMap.size()){var t=e.callback;e.callback=null,t.call()}}load(e,t){return this.stylesQueueSize++,new Promise((s=>{x.get(t).then((i=>{if(!i.ok)throw"Unable to load styles for "+e+" at "+t;i.text().then((i=>{this.set(e,new P(i),t),this.doCallback(this),s()}))}))}))}getStylesLoadedPromise(e){return new Promise(((t,s)=>{var i=0;e&&0!=e.size()?e.forEach(((n,a,r)=>this.contains(n)?++i!=e.size()||(t(),!1):(this.privateLoad(n,new b(a)).then((()=>{if(++i==e.size())return t(),!1})).catch((e=>(s(e),!1))),!0)),this):t()}))}privateLoad(e,t){return k.info("Loading styles "+e+" at "+t.toString()),new Promise((s=>{x.get(t).then((i=>{if(!i.ok)throw"Unable to load styles for "+e+" at "+t;i.text().then((i=>{this.set(e,new P(i),t),s()}))}))}))}}class V{constructor(e){this.templateSource=e}getTemplateSource(){return this.templateSource}}const A=new r("TemplateRegistry");class N{constructor(){this.templateMap=new a,this.templateUrlMap=new a,this.templateQueueSize=0,this.callback=null,this.languagePrefix=null}setLanguagePrefix(e){this.languagePrefix=e}set(e,t,s){null!=s&&this.templateUrlMap.set(e,s),this.templateMap.set(e,t)}get(e){return this.templateMap.get(e)}contains(e){return this.templateMap.contains(e)}done(e){this.callback=e,this.doCallback(this)}doCallback(e){if(null!==tmo.callback&&void 0!==e.callback&&e.templateQueueSize===e.templateMap.size()){var t=e.callback;e.callback=null,t.call()}}load(e,t){return null!==this.languagePrefix&&t.getPathList().setLast(this.languagePrefix+"."+t.getPathList().getLast()),this.templateQueueSize++,new Promise((s=>{x.get(t).then((i=>{if(!i.ok)throw"Unable to load template for "+e+" at "+t;i.text().then((i=>{this.set(e,new V(i),t),this.doCallback(this),s()}))}))}))}getTemplatesLoadedPromise(e){return new Promise(((t,s)=>{var i=0;e&&0!=e.size()?e.forEach(((n,a,r)=>this.contains(n)?++i!=e.size()||(t(),!1):(this.privateLoad(n,new b(a)).then((()=>{if(++i==e.size())return t(),!1})).catch((e=>(s(e),!1))),!0)),this):t()}))}privateLoad(e,t){return null!==this.languagePrefix&&t.getPathList().setLast(this.languagePrefix+"."+t.getPathList().getLast()),A.info("Loading template "+e+" at "+t.toString()),new Promise((s=>{x.get(t).then((i=>{if(!i.ok)throw"Unable to load template for "+e+" at "+t;i.text().then((i=>{this.set(e,new V(i),t),s()}))}))}))}}new r("TemplatePostConfig");class I{constructor(e){this.templateRegistry=e}load(e){let t=new a;return e.forEach(((e,s,i)=>(s.classReference.TEMPLATE_URL&&s.classReference.COMPONENT_NAME&&t.set(s.classReference.COMPONENT_NAME,s.classReference.TEMPLATE_URL),!0)),this),this.templateRegistry.getTemplatesLoadedPromise(t)}}new r("StylesLoader");class U{constructor(e){this.stylesRegistry=e}load(e){let t=new a;return e.forEach(((e,s,i)=>(s.classReference.STYLES_URL&&s.classReference.COMPONENT_NAME&&t.set(s.classReference.COMPONENT_NAME,s.classReference.STYLES_URL),!0)),this),this.stylesRegistry.getStylesLoadedPromise(t)}}new r("ComponentConfigProcessor");class H{constructor(){this.templateRegistry=u.instance(N),this.stylesRegistry=u.instance(R)}postConfig(){this.templatesLoader=new I(this.templateRegistry),this.stylesLoader=new U(this.stylesRegistry)}processConfig(e,t){return Promise.all([this.templatesLoader.load(t),this.stylesLoader.load(t)])}}class O{constructor(e){this.attribute=e}get value(){return this.attribute.value}get name(){return this.attribute.name}get namespace(){return this.attribute.name}}const z=new r("BaseElement");class F{constructor(e,t){this.element=null,this.attributeMap=null,this.eventsAttached=new n,e instanceof v?this.element=this.createFromXmlElement(e,t):"string"!=typeof e?s.isUIElement(e)?this.element=e:(z.error("Unrecognized value for Element"),z.error(e)):this.element=s.createElement(e)}loadAttributes(){if(null!==this.element.attributes&&void 0!==this.element.attributes){if(null===this.attributeMap||void 0===this.attributeMap){this.attributeMap=new a;for(var e=0;e<this.element.attributes.length;e++)this.attributeMap.set(this.element.attributes[e].name,new O(this.element.attributes[e]))}}else this.attributeMap=new a}createFromXmlElement(e,t){let i=null;return i=e.namespace?s.createElementNS(e.namespaceUri,e.fullName):s.createElement(e.name),t&&null!==t.mappedElement&&s.appendChild(t.mappedElement,i),e.attributes.forEach(((e,t)=>(s.setAttribute(i,e,t.value),!0))),i}attachEvent(e,t,i=!1){this.eventsAttached.contains(e)?z.warn("Event '"+e+"' allready attached for "+this.element.name):(e.startsWith("on")&&(e=e.substr(2)),s.addEventListener(this.element,e,t,i),this.eventsAttached.add(e))}listenTo(e,t,i){s.addEventListener(this.element,e,(e=>{t.call(new J(e))}),i)}get mappedElement(){return this.element}get fullName(){return this.element.tagName}get top(){return this.element.getBoundingClientRect().top}get bottom(){return this.element.getBoundingClientRect().bottom}get left(){return this.element.getBoundingClientRect().left}get right(){return this.element.getBoundingClientRect().right}get width(){return this.element.offsetWidth}get height(){return this.element.offsetHeight}get attributes(){return this.loadAttributes(),this.attributeMap}setAttributeValue(e,t){s.setAttribute(this.element,e,t)}getAttributeValue(e){return s.getAttribute(this.element,e)}containsAttribute(e){return this.element.hasAttribute(e)}removeAttribute(e){this.element.removeAttribute(e)}setStyle(e,t){this.element.style[e]=t}getStyle(e){return this.element.style[e]}removeStyle(e){this.element.style[e]=null}set(e){if(null!==this.element.parentNode){if(!e.mappedElement)return e&&null!==e.rootElement?(this.element.parentNode.replaceChild(e.rootElement.mappedElement,this.element),void(this.element=e.rootElement.mappedElement)):void("string"!=typeof e?(e instanceof Text||e instanceof Element)&&this.element.parentNode.replaceChild(e,this.element):this.element.parentNode.replaceChild(s.createTextNode(e),this.element));this.element.parentNode.replaceChild(e.mappedElement,this.element)}else console.error("The element has no parent, can not swap it for value")}isMounted(){return!!this.element.parentNode}remove(){this.element.parentNode.removeChild(this.element)}clear(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild)}setChild(e){this.clear(),this.addChild(e)}addChild(e){void 0===e.mappedElement||null===e.mappedElement?e&&e.rootElement?this.element.appendChild(e.rootElement.mappedElement):"string"!=typeof e?(e instanceof Text||e instanceof Element)&&this.element.appendChild(e):this.element.appendChild(s.createTextNode(e)):this.element.appendChild(e.mappedElement)}prependChild(e){null===this.element.firstChild&&this.addChild(e),void 0===e.mappedElement||null===e.mappedElement?e&&e.rootElement?this.element.insertBefore(e.rootElement.mappedElement,this.element.firstChild):"string"!=typeof e?(e instanceof Text||e instanceof Element)&&this.element.insertBefore(e,this.element.firstChild):this.element.insertBefore(s.createTextNode(e),this.element.firstChild):this.element.insertBefore(e.mappedElement,this.element.firstChild)}}new r("AbstractInputElement");class B extends F{constructor(e,t){super(e,t)}get name(){return this.element.name}set name(e){this.element.name=e}get value(){return this.backingValue}set value(e){this.element.value=e,this.element.dispatchEvent(new InputEvent("change"))}get backingValue(){return this.element.value}focus(){this.element.focus()}selectAll(){this.element.select()}enable(){this.element.disabled=!1}disable(){this.element.disabled=!0}}class _ extends B{constructor(e,t){super(e,t)}set checked(e){this.element.checked=e}isChecked(){return this.element.checked}get value(){return this.isChecked()}set value(e){this.element.checked=!0===e||"true"===e}}class j extends B{constructor(e,t){super(e,t)}set checked(e){this.element.checked=e}isChecked(){return this.element.checked}get value(){return this.isChecked()}set value(e){this.element.checked=!0===e||"true"===e}}class W extends B{constructor(e,t){super(e,t)}}class D extends B{constructor(e,t){super(e,t)}get innerHTML(){return this.element.innerHTML}set innerHTML(e){this.element.innerHTML=e}addChild(e){super.addChild(e),this.value=this.innerHTML}prependChild(e){super.prependChild(e),this.value=this.innerHTML}}class X{constructor(e,t){e instanceof y&&(this.element=this.createFromXmlCdata(e,t)),"string"==typeof e&&(this.element=s.createTextNode(e))}createFromXmlCdata(e,t){let i=document.createTextNode(e.value);return null!==t&&null!==t.mappedElement&&s.appendChild(t.mappedElement,i),i}set value(e){this.element=e}get value(){return this.element}get mappedElement(){return this.element}}class q extends F{constructor(e,t){super(e,t)}get innerHTML(){return this.element.innerHTML}set innerHTML(e){this.element.innerHTML=e}}class Q extends F{constructor(e,t){super(e,t)}get name(){return this.element.name}set name(e){this.element.name=e}submit(){return this.element.submit()}}class Y extends F{constructor(e,t){super(e,t)}get mappedElement(){return this.element}play(){this.element.play()}mute(){this.element.muted=!0}unmute(){this.element.muted=!1}}class ${static map(e,t){return $.mapsToRadio(e)?new _(e,t):$.mapsToCheckbox(e)?new j(e,t):$.mapsToSubmit(e)?new W(e,t):$.mapsToForm(e)?new Q(e,t):$.mapsToTextarea(e)?new D(e,t):$.mapsToText(e)?new W(e,t):$.mapsToVideo(e)?new Y(e,t):$.mapsToTextnode(e)?new X(e,t):($.mapsToSimple(e)||console.log("Mapping to simple by default "+e),new q(e,t))}static mapsToRadio(e){return e instanceof HTMLInputElement&&"radio"===e.type||e instanceof v&&"input"===e.name&&e.getAttribute("type")&&"radio"===e.getAttribute("type").value}static mapsToCheckbox(e){return e instanceof HTMLInputElement&&"checkbox"===e.type||e instanceof v&&"input"===e.name&&e.getAttribute("type")&&"checkbox"===e.getAttribute("type").value}static mapsToSubmit(e){return e instanceof HTMLInputElement&&"submit"===e.type||e instanceof v&&"input"===e.name&&e.getAttribute("type")&&"submit"===e.getAttribute("type").value}static mapsToForm(e){return e instanceof HTMLFormElement||e instanceof v&&"form"===e.name}static mapsToText(e){if(e instanceof HTMLInputElement){if("text"===e.type)return!0;if("password"===e.type)return!0;if("email"===e.type)return!0;if("date"===e.type)return!0;if("time"===e.type)return!0}if(e instanceof v&&"input"===e.name){if(!e.getAttribute("type"))return!0;if("text"===e.getAttribute("type").value)return!0;if("password"===e.getAttribute("type").value)return!0;if("email"===e.getAttribute("type").value)return!0;if("date"===e.getAttribute("type").value)return!0;if("time"===e.getAttribute("type").value)return!0}return!1}static mapsToTextnode(e){return e instanceof Node&&"TEXT_NODE"===e.nodeType||e instanceof y}static mapsToVideo(e){return e instanceof HTMLVideoElement||e instanceof v&&"video"===e.name}static mapsToTextarea(e){return e instanceof HTMLTextAreaElement||e instanceof v&&"textarea"===e.name}static mapsToSimple(e){return e instanceof HTMLElement||e instanceof v}}class J{constructor(e){this.event=e,"dragstart"==this.event.type.toLowerCase()&&this.event.dataTransfer.setData("text/plain",null)}stopPropagation(){this.event.stopPropagation()}preventDefault(){this.event.preventDefault()}getOffsetX(){return this.event.offsetX}getOffsetY(){return this.event.offsetY}getClientX(){return this.event.clientX}getClientY(){return this.event.clientY}getTarget(){if(this.event&&this.event.target)return $.map(this.event.target)}getRelatedTarget(){return this.event&&this.event.relatedTarget?$.map(this.event.relatedTarget):null}getRelatedTargetAttribute(e){return this.event.relatedTarget?$.map(this.event.relatedTarget).getAttributeValue(e):null}getTargetValue(){return this.getTarget()?this.getTarget().value:null}getKeyCode(){return this.event.keyCode}isKeyCode(e){return this.event.keyCode===e}}new r("EventRegistry");class K{constructor(){this.listeners=new a}attach(e,t,s,i,n=!1){const a=s+"_"+i,r=this;e.attachEvent(t,(function(e){r.trigger(a,e)}),n)}listen(e,t,s){this.initMap(e+"_"+s).set(t.object.constructor.name,t)}initMap(e){return this.listeners.exists(e)||this.listeners.set(e,new a),this.listeners.get(e)}trigger(e,t){this.listeners.exists(e)&&this.listeners.get(e).forEach(((e,s,i)=>(s.call(new J(t)),!0)),this)}}class G{idAttributeWithSuffix(e){if(Z.contains(e)){var t=Z.get(e);return Z.set(e,t+1),e+"-"+t}return Z.set(e,1),e}}var Z=new a;class ee{constructor(e,t,s){this.componentIndex=e,this.elementMap=s,this.rootElement=t}remove(){this.rootElement.remove()}get(e){return this.elementMap.get(e)}set(e,t){return this.elementMap.get(e).set(t),this.elementMap.get(e)}clearChildren(e){return this.elementMap.get(e).clear(),this.elementMap.get(e)}setChild(e,t){return this.elementMap.get(e).setChild(t),this.elementMap.get(e)}addChild(e,t){return this.elementMap.get(e).addChild(t),this.elementMap.get(e)}prependChild(e,t){return this.elementMap.get(e).prependChild(t),this.elementMap.get(e)}}class te{constructor(e,t,s){this.componentIndex=s,this.uniqueIdRegistry=t,this.eventRegistry=e,this.rootElement=null,this.elementMap=new a}getElementMap(){return this.elementMap}elementCreated(e,t){var s=$.map(e,t);return this.addToElementIdMap(s),this.registerElementEvents(s),null===this.rootElement&&null!==s&&(this.rootElement=s),s}registerElementEvents(e){if(null!=e&&e instanceof F){var t=this.eventRegistry,s=this.componentIndex;e.attributes.forEach((function(i,n,a){if(null!=n&&n.value.startsWith("//event:")){var r=n.value,l=n.name;t.attach(e,l,r,s)}return!0}),this)}}addToElementIdMap(e){if(null!=e&&e instanceof F){var t=null;e.containsAttribute("id")&&(t=e.getAttributeValue("id"),e.setAttributeValue("id",this.uniqueIdRegistry.idAttributeWithSuffix(t))),null!==t&&this.elementMap.set(t,e)}}}class se{static shouldSwallowNextFocusEscape=!1;static replaceComponent(e,t){const i=s.getElementById(e);i.parentNode.replaceChild(t.rootElement.mappedElement,i)}static setComponent(e,t){const i=s.getElementById(e);i.innerHTML="",i.appendChild(t.rootElement.mappedElement,i)}static addChildComponent(e,t){s.getElementById(e).appendChild(t.rootElement.mappedElement)}static addChildElement(e,t){s.getElementById(e).appendChild(t.mappedElement)}static removeElement(e){s.removeElement(e)}static addHeaderElement(e){s.appendRootMetaChild(e.mappedElement)}static addBodyElement(e){s.appendRootUiChild(e.mappedElement)}static prependHeaderElement(e){s.prependElement("head",e.mappedElement)}static prependBodyElement(e){s.prependElement("body",e.mappedElement)}static listenToFocusEscape(e,t){const n=new l(null,(i=>{s.contains(t.element,i.getTarget().element)||se.shouldSwallowNextFocusEscape||e.call(i)}));i.addEventListener("click",n,J)}static swallowFocusEscape(e){se.shouldSwallowNextFocusEscape=!0,setTimeout((()=>{se.shouldSwallowNextFocusEscape=!1}),e)}}class ie{static custom(e){var t=new v(e);return $.map(t)}static applyStyles(e,t,s){t&&e.setAttributeValue("class",t),s&&e.setAttributeValue("style",s)}static a(e,t,s,i){var n=ie.custom("a");return n.addChild(e),n.setAttributeValue("href",t),ie.applyStyles(n,s,i),n}static i(e,t,s){var i=ie.custom("i");return i.addChild(e),ie.applyStyles(i,t,s),i}}const ne=new r("CanvasStyles"),ae=new a,re=new a,le=new n;class oe{static setStyle(e,t){if(ae.contains(e))ae.get(e).setChild(new X(t.getStylesSource()));else{let s=ie.custom("style");s.setAttributeValue("id",e),s.setChild(new X(t.getStylesSource())),ae.set(e,s)}}static removeStyle(e){le.contains(e)&&(le.remove(e),se.removeElement(e)),ae.contains(e)&&ae.remove(e)}static disableStyle(e,t=0){oe.removeStyleOwner(e,t),oe.hasStyleOwner(e)||(ae.contains(e)?le.contains(e)&&(le.remove(e),se.removeElement(e)):ne.error("Style does not exist: "+e))}static enableStyle(e,t=0){oe.addStyleOwner(e,t),ae.contains(e)?le.contains(e)||(le.add(e),se.addHeaderElement(ae.get(e))):ne.error("Style does not exist: "+e)}static addStyleOwner(e,t){re.contains(e)||re.set(e,new n),re.get(e).contains(t)||re.get(e).add(t)}static removeStyleOwner(e,t){re.contains(e)&&re.get(e).remove(t)}static hasStyleOwner(e){return!!re.contains(e)&&re.get(e).size()>0}}const he=new r("ComponentFactory");class ue{constructor(){this.eventRegistry=u.instance(K),this.stylesRegistry=u.instance(R),this.templateRegistry=u.instance(N),this.uniqueIdRegistry=u.instance(G)}create(e){var t=this.templateRegistry.get(e);if(!t)throw he.error(this.templateRegistry),"No template was found with name "+e;var s=new te(this.eventRegistry,this.uniqueIdRegistry,ce++);return new w(t.getTemplateSource(),s).load(),this.mountStyles(e),new ee(s.componentIndex,s.rootElement,s.getElementMap())}mountStyles(e){this.stylesRegistry.contains(e)&&oe.setStyle(e,this.stylesRegistry.get(e))}}var ce=0;new r("Config");class de{static getInstance(){return me}constructor(){this.typeConfigList=new n([c.unnamed(N),c.unnamed(R),c.unnamed(G),c.unnamed(ue),d.unnamed(K)])}getTypeConfigList(){return this.typeConfigList}}const me=new de,pe=new r("LoaderInterceptor");class ge{process(){return pe.info("Unimplemented Loader Interceptor breaks by default"),!1}}const fe=new r("ModuleLoader");class ve{constructor(e,t,s=[]){this.matchPath=e,this.modulePath=t,this.loaderInterceptors=s}matches(e){return!this.matchPath||(e?o.nonNullEquals(this.matchPath,e.getPath()):(fe.error("Url is null"),!1))}load(){return this.importModule().then((e=>this.interceptorsPass().then((()=>e)).catch((e=>{fe.warn("Filter rejected "+e)}))))}interceptorsPass(){const e=this.loaderInterceptors;if(e&&e.length>0){let t=e[0].process();for(let s=1;s<e.length;s++)t=t.then(e[s]);return t}return Promise.resolve()}importModule(){return new Promise(((e,t)=>{import(this.modulePath).then((t=>{e(new t.default)})).catch((e=>{t(e)}))}))}}class ye{load(e){throw"Main class must implement load(url)"}update(){throw"Main class must implement update()"}get path(){throw"Main class must implement get path()"}}const we=new r("DiModuleLoader");class Ee extends ve{constructor(e,t,s,i=[]){super(t,s,i),this.config=e}load(){return this.importModule().then((e=>this.interceptorsPass().then((()=>m.inject(e,this.config))).catch((e=>{throw we.warn("Filter rejected "+e),e})))).catch((e=>{throw e}))}importModule(){return new Promise(((e,t)=>super.importModule().then((s=>{this.config.addAllTypeConfig(s.typeConfigList),this.config.finalize().then((()=>{new n(this.loaderInterceptors).promiseChain((e=>m.inject(e,this.config))).then((()=>{e(s)})).catch((e=>{t(e)}))})).catch((e=>{t(e)}))})).catch((e=>{t(e)}))))}}const be=new r("Application");class Me extends E{constructor(){super(),this.workerList=new n,this.moduleLoaderList=new n,this.config=new p,this.runningWorkers=new n,this.activeMain=null,this.defaultConfig=de.getInstance().getTypeConfigList(),this.defaultConfigProcessors=new n([H]),this.defaultInstanceProcessors=new n([g]),this.customConfig=new n}set customTypeConfig(e){this.customConfig=e}run(){be.info("Running Application"),this.config.addAllTypeConfig(this.defaultConfig).addAllTypeConfig(this.customConfig).addAllConfigProcessor(this.defaultConfigProcessors).addAllInstanceProcessor(this.defaultInstanceProcessors),S.instance().set(this),e.addUserNavigateListener(new l(this,this.update),J),this.runModule(M.currentUrl()).then((()=>{this.startWorkers()}))}update(e){const t=M.currentUrl();this.activeMain&&o.nonNullEquals(this.activeMain.path,t.getPath())?this.activeMain.update(t):this.runModule(t)}runModule(e){return this.getMatchingModuleLoader(e).load().then((t=>{this.activeMain=t,t.load(e,null)})).catch((e=>{be.error(e)}))}startWorkers(){this.runningWorkers.size()>0||this.workerList.forEach(((e,t)=>{const s=new e;return m.inject(s,this.config),this.runningWorkers.add(s),!0}),this)}getMatchingModuleLoader(e){let t=null;return this.moduleLoaderList.forEach(((s,i)=>!s.matches(e)||(t=s,!1)),this),t}windowDiConfig(){window.diConfig=()=>{be.info(this.config.configEntries)}}windowTemplateRegistry(){window.templateRegistry=()=>{be.info(f.instanceHolder(N.name,this.config).instance)}}windowStyleRegistry(){window.styleRegistry=()=>{be.info(f.instanceHolder(R.name,this.config).instance)}}}new r("InputElementDataBinding");class Te{constructor(e,t){this.model=e,this.validator=t,this.pullers=new n,this.pushers=new n}static link(e,t){return new Te(e,t)}and(e){return this.to(e)}to(e){const t=()=>{h.getValue(this.model,e.name)!==e.value&&h.setValue(this.model,e.name,e.value),this.validator&&this.validator.validate&&this.validator.validate(e.value)};e.attachEvent("onchange",t),e.attachEvent("onkeyup",t),t.call();let s="__changed_"+e.name.replace(".","_");return this.model[s]||(this.model[s]=()=>{this.push()}),this.pullers.add(t),this.pushers.add((()=>{var t=h.getValue(this.model,e.name);t!==e.value&&(e.value=t),this.validator&&this.validator.validateSilent&&e.value&&this.validator.validateSilent(e.value)})),this}pull(){this.pullers.forEach(((e,t)=>(e.call(t),!0)),this)}push(){this.pushers.forEach(((e,t)=>(e.call(t),!0)),this)}}class Ce{static createProxyObject(e){return new Proxy(e,{set:(e,t,s)=>{let i=e[t]=s,n=e["__changed_"+t];if(n&&"function"==typeof n){n.bind(e)()}return i===s}})}}class Le extends l{constructor(e,t){this.objectFunction=e,this.filter=t}call(e){this.filter&&this.filter.call(this,e)&&this.objectFunction.call(e)}}class Se{constructor(){this.path=null,this.property=null,this.waypoint=null,this.destination=null,this.next=null}}class xe{static load(e,t,s){const i=xe.processNode(e,t,s),n=M.currentUrl();n.setBookmark(null),M.replaceUrl(n,n.toString(),i),i.forEach((e=>(n.setBookmark(e),M.pushUrl(n,n.toString(),i),!0)),this)}static update(e,t,s){xe.processNode(e,t,s)}static processNode(e,t,s,i=new n){let a=e;return t.property&&(a=e[t.property]),o.startsWith(s.bookmark,xe.toStartsWith(t.path))&&(i.add(t.path),t.waypoint&&t.waypoint.call(a)),o.nonNullEquals(s.bookmark,t.path)&&(i.add(t.path),t.destination&&t.destination.call(a)),t.next&&t.next.forEach((e=>{i=xe.processNode(a,e,s,i)})),i}static toStartsWith(e){return null==e||o.nonNullEquals(e,"/")?"/":e+"/"}}new r("HttpCallBuilder");class Pe{constructor(e,t){this.url=e,this.payload=t,this.authorization=null,this.successMappingMap=new a,this.failMappingMap=new a,this.errorMappingFunction=e=>e,this.connectionTimeoutValue=4e3,this.responseTimeoutValue=4e3}static newInstance(e,t){return new Pe(e,t)}successMapping(e,t=(()=>null)){return this.successMappingMap.set(e,t),this}failMapping(e,t=(()=>null)){return this.failMappingMap.set(e,t),this}errorMapping(e){return this.errorMappingFunction=e,this}authorizationHeader(e){return this.authorization="Bearer "+e,this}connectionTimeout(e){this.connectionTimeoutValue=e}responseTimeout(e){this.responseTimeoutValue=e}get(){return this.asTypeMappedPromise(x.get(this.url,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization))}post(){return this.asTypeMappedPromise(x.post(this.url,this.payload,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization))}put(){return this.asTypeMappedPromise(x.put(this.url,this.payload,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization))}patch(){return this.asTypeMappedPromise(x.patch(this.url,this.payload,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization))}delete(){return this.asTypeMappedPromise(x.delete(this.url,this.connectionTimeoutValue,this.responseTimeoutValue))}asTypeMappedPromise(e){return new Promise(((t,s)=>{e.then((e=>{this.handleFetchResponse(e,t,s)})).catch((e=>{s(this.errorMappingFunction(e))}))}))}handleFetchResponse(e,t,s){const i=this.successMappingMap.get(e.status),n=this.failMappingMap.get(e.status);if(204===e.status||"0"===e.headers.get("Content-Length"))return i?void t(i(null)):n?void s(n(null)):void s(new Error("Missing mapper for return status: "+e.status));e.json().then((e=>{i?t(i(e)):s(n?n(e):this.errorMappingFunction(e))})).catch((e=>{s(this.errorMappingFunction(e))}))}}const ke=new r("AbstractValidator");class Re{constructor(e=!1,t=!0){this.validListenerList=new n,this.invalidListenerList=new n,this.currentlyValid=e,this.enabled=t}enable(){this.enabled=!0,this.isValid()?this.valid():this.invalid()}disable(){let e=this.currentlyValid;this.valid(),this.enabled=!1,this.currentlyValid=e}isValid(){return!this.enabled||this.currentlyValid}valid(){this.enabled&&(this.currentlyValid=!0,this.validListenerList?this.validListenerList.forEach(((e,t)=>(e.call(),!0)),this):ke.warn("No validation listeners"))}invalid(){this.enabled&&(this.currentlyValid=!1,this.invalidListenerList?this.invalidListenerList.forEach(((e,t)=>(e.call(),!0)),this):ke.warn("No invalidation listeners"))}validSilent(){this.currentlyValid=!0}invalidSilent(){this.currentlyValid=!1}withValidListener(e){return this.validListenerList.add(e),this}withInvalidListener(e){return this.invalidListenerList.add(e),this}}class Ve extends Re{constructor(e=!1){super(e),this.validatorList=new n}withValidator(e){return e.withValidListener(new l(this,this.oneValid)),e.withInvalidListener(new l(this,this.oneInvalid)),this.validatorList.add(e),this}oneValid(){let e=!1;this.validatorList.forEach(((t,s)=>!!t.isValid()||(e=!0,!1)),this),e?super.invalid():super.valid()}oneInvalid(){super.invalid()}}class Ae extends Re{constructor(e=!1,t=!1,s="(.*)"){super(t),this.mandatory=e,this.regex=s}validate(e){e&&"string"==typeof e&&e.match(this.regex)?this.valid():e||this.mandatory?this.invalid():this.valid()}validateSilent(e){e&&"string"==typeof e&&e.match(this.regex)?this.validSilent():e||this.mandatory?this.invalidSilent():this.validSilent()}}const Ne=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;class Ie extends Ae{constructor(e=!1,t=!1){super(e,t,Ne)}}class Ue extends Re{constructor(e=!1,t=!1,s=null){super(t),this.mandatory=e,this.comparedValueFunction=s}validate(e){!e&&this.mandatory?this.invalid():e===this.comparedValueFunction.call()?this.valid():this.invalid()}validateSilent(e){!e&&this.mandatory?this.invalidSilent():e===this.comparedValueFunction.call()?this.validSilent():this.invalidSilent()}}class He extends Re{constructor(e=!1,t=!1,s=null,i=null){super(t),this.mandatory=e,this.model=s,this.attributeName=i}validate(e){!e&&this.mandatory?this.invalid():e===h.getValue(this.model,this.attributeName)?this.valid():this.invalid()}validateSilent(e){!e&&this.mandatory?this.invalidSilent():e===h.getValue(this.model,this.attributeName)?this.validSilent():this.invalidSilent()}}class Oe extends Re{constructor(e=!1,t=!1,s=null){super(t),this.mandatory=e,this.controlValue=s}validate(e){!e&&this.mandatory?this.invalid():e===controlValue?this.valid():this.invalid()}validateSilent(e){!e&&this.mandatory?this.invalidSilent():e===controlValue?this.validSilent():this.invalidSilent()}}class ze extends Re{constructor(e=!1){super(e),this.validatorList=new n}withValidator(e){return e.withValidListener(new l(this,this.oneValid)),e.withInvalidListener(new l(this,this.oneInvalid)),this.validatorList.add(e),this}oneValid(){super.valid()}oneInvalid(){let e=!1;this.validatorList.forEach(((t,s)=>!t.isValid()||(e=!0,!1)),this),e?super.valid():super.invalid()}}const Fe=/^(?=.*[A-Za-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;class Be extends Ae{constructor(e=!1,t=!1){super(e,t,Fe)}}const _e=/^\+[0-9]{2}\s?([0-9]\s?)*$/;class je extends Ae{constructor(e=!1,t=!1){super(e,t,_e)}}class We extends Re{constructor(e=!1,t=!0){super(e,t)}validate(e){""===e?this.invalid():this.valid()}validateSilent(e){""===e?this.invalidSilent():this.validSilent()}}export{B as AbstractInputElement,Re as AbstractValidator,S as ActiveModuleRunner,Ve as AndValidatorSet,Me as Application,O as Attribute,F as BaseElement,se as CanvasRoot,oe as CanvasStyles,j as CheckboxInputElement,x as Client,ee as Component,H as ComponentConfigProcessor,ue as ComponentFactory,de as Config,Ee as DiModuleLoader,$ as ElementMapper,te as ElementRegistrator,Ie as EmailValidator,Ue as EqualsFunctionResultValidator,He as EqualsPropertyValidator,Oe as EqualsStringValidator,J as Event,Le as EventFilteredObjectFunction,K as EventRegistry,Q as FormElement,ie as HTML,M as History,Pe as HttpCallBuilder,Te as InputElementDataBinding,ge as LoaderInterceptor,ye as Main,ve as ModuleLoader,E as ModuleRunner,C as Navigation,ze as OrValidatorSet,Be as PasswordValidator,je as PhoneValidator,Ce as ProxyObjectFactory,_ as RadioInputElement,Ae as RegexValidator,We as RequiredValidator,q as SimpleElement,P as Styles,U as StylesLoader,R as StylesRegistry,V as Template,N as TemplateRegistry,I as TemplatesLoader,W as TextInputElement,D as TextareaInputElement,X as TextnodeElement,Se as TrailNode,xe as TrailProcessor,G as UniqueIdRegistry,b as Url,Y as VideoElement};
