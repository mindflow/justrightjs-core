import{ContainerUrl as t,ContainerHttpClient as e,ContainerElement as i,ContainerWindow as s}from"./containerbridge_v1.js";import{List as n,Map as r,Logger as a,ObjectFunction as l,StringUtils as o,PropertyAccessor as h}from"./coreutil_v1.js";import{InjectionPoint as u,SingletonConfig as c,PrototypeConfig as d,MindiInjector as p,MindiConfig as m,InstancePostConfigTrigger as g,ConfigAccessor as f}from"./mindi_v1.js";import{XmlElement as v,XmlCdata as w,DomTree as y}from"./xmlparser_v1.js";class E{runModule(t){}}class b{constructor(t,e,i,s,a,l){this.protocolString=t,this.hostString=e,this.portString=i,this.pathValueList=s,this.parameterValueMap=a,this.bookmarkString=l,this.pathValueList||(this.pathValueList=new n),this.parameterValueMap||(this.parameterValueMap=new r)}get protocol(){return this.protocolString}get host(){return this.hostString}get port(){return this.portString}get pathsList(){return this.pathValueList}get bookmark(){return this.bookmarkString}get parameterMap(){return this.parameterValueMap}getPathPart(t){return this.pathValueList.get(t)}get path(){let t="/",e=!0;return this.pathValueList.forEach((i=>{e||(t+="/"),t+=i,e=!1}),this),t}getParameter(t){return this.parameterMap.get(t)}toString(){var t="";null!==this.protocol&&(t=t+this.protocol+"//"),null!==this.host&&(t+=this.host),null!==this.port&&(t=t+":"+this.port),this.pathValueList.forEach((function(e,i){return t=t+"/"+e,!0}),this);var e=!0;return this.parameterMap.forEach((function(i,s,n){e?(e=!1,t+="?"):t+="&",t=t+encodeURI(i)+"="+encodeURI(s)}),this),null!==this.bookmark&&(t=t+"#"+this.bookmark),t}}class M{static parse(t){let e={string:t};if(null===t)return null;const i=M.determineProtocol(e),s=M.determineHostAndPort(e),n=M.extractHost(s),r=M.extractPort(s),a=M.determinePath(e),l=M.determineParameters(e),o=M.determineBookmark(e);return new b(i,n,r,a,l,o)}static determineProtocol(t){let e=t.string;if(!e)return null;let i=e;if(-1===e.indexOf("//"))return null;let s=e.split("//");return-1!==s[0].indexOf("/")?null:(i=s[0],1==s.length?t.string=null:t.string=e.replace(s[0]+"//",""),i)}static determineHostAndPort(t){let e=t.string;if(!e)return null;let i=e,s=null;return-1!==i.indexOf("/")&&(i=i.split("/")[0],s=e.replace(i+"/","")),t.string=s,i}static extractHost(t){return t?-1===t.indexOf(":")?t:t.split(":")[0]:null}static extractPort(t){return t?-1===t.indexOf(":")?null:t.split(":")[1]:null}static determinePath(t){let e=t.string;if(!e)return new n;let i=e;if(-1!==i.indexOf("?")){let e=i.split("?");e.length>1&&(t.string=i.substring(i.indexOf("?"))),i=e[0]}else if(-1!==i.indexOf("#")){let e=i.split("#");e.length>1&&(t.string=i.substring(i.indexOf("#"))),i=e[0]}else t.string=null;i.startsWith("/")&&(i=e.substring(1));const s=new n(i.split("/")),r=new n;return s.forEach((t=>(r.add(decodeURI(t)),!0)),this),r}static determineParameters(t){const e=t.string;if(!e)return new r;let i=e;if(-1===i.indexOf("?"))return new r;i=i.substring(i.indexOf("?")+1),-1!==i.indexOf("#")?(t.string=i.substring(i.indexOf("#")),i=i.substring(0,i.indexOf("#"))):t.string=null;const s=new n(i.split("&")),a=new r;return s.forEach((t=>{let e=t.split("=");return e.length>=2&&a.set(decodeURI(e[0]),decodeURI(e[1])),!0}),this),a}static determineBookmark(t){let e=t.string;if(!e)return t.string=null,null;let i=e;return-1!==e.indexOf("#")&&(i=e.substring(e.indexOf("#")+1),t.string=null),i}}class T{static replaceUrl(e,i,s){t.replaceUrl(e.toString(),i,s)}static pushUrl(e,i,s){t.pushUrl(e.toString(),i,s)}static currentUrl(){return M.parse(t.currentUrl())}}class L{constructor(){this.protocol=null,this.host=null,this.port=null,this.pathsList=new n,this.parametersMap=new r,this.bookmark=null}static builder(){return new L}withUrl(t){return this.withAllOfUrl(M.parse(t)),this}withRootOfUrl(t){return this.protocol=t.protocol,this.port=t.port,this.host=t.host,this}withPathOfUrl(t){return this.withRootOfUrl(t),this.pathsList=t.pathsList,this}withAllOfUrl(t){return this.withPathOfUrl(t),this.parametersMap=t.parameterMap,this.bookmark=t.bookmark,this}withProtocol(t){return this.protocol=M.determinePath({string:t}),this}withHost(t){return this.host=M.determinePath({string:t}),this}withPath(t){return this.pathsList=M.determinePath({string:t}),this}withParameters(t){return this.parametersMap=M.determinePath({string:t}),this}withBookmark(t){return this.bookmark=M.determineBookmark({string:t}),this}build(){return new b(this.protocol,this.host,this.port,this.pathsList,this.parametersMap,this.bookmark)}}let S=null;class C{constructor(){}static instance(){return S||(S=new C),S}go(e){t.go(e.toString())}back(){t.back()}load(t){const e=T.currentUrl(),i=L.builder().withRootOfUrl(e).withPath(t).build();return T.pushUrl(i),i}}let x=null;class k{constructor(){this.moduleRunner=null}static instance(){return x||(x=new k),x}set(t){this.moduleRunner=t}load(t){const e=C.instance().load(t);this.moduleRunner.runModule(e)}}class P{static get(t,i=4e3,s=4e3,n=null){var r={headers:P.getHeader(n),method:"GET",mode:"cors",redirect:"follow"};return e.fetch(t.toString(),r,i,s)}static post(t,i,s=4e3,n=4e3,r=null){let a=P.getHeader(r);var l={body:JSON.stringify(i),headers:a,method:"POST",mode:"cors",redirect:"follow"};return e.fetch(t.toString(),l,s,n)}static put(t,i,s=4e3,n=4e3,r=null){let a=P.getHeader(r);var l={body:JSON.stringify(i),method:"PUT",mode:"cors",redirect:"follow",headers:a};return e.fetch(t.toString(),l,s,n)}static patch(t,i,s=4e3,n=4e3,r=null){let a=P.getHeader(r);var l={body:JSON.stringify(i),method:"PATCH",mode:"cors",redirect:"follow",headers:a};return e.fetch(t.toString(),l,s,n)}static delete(t,i=4e3,s=4e3){return e.fetch(t.toString(),{method:"DELETE",mode:"cors",redirect:"follow"},i,s)}static getHeader(t=null){let e={"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"};return t&&(e={"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json",Authorization:t}),e}}class V{constructor(t){this.stylesSource=t}getStylesSource(){return this.stylesSource}}const R=new a("StylesRegistry");class A{constructor(){this.stylesMap=new r,this.stylesUrlMap=new r,this.stylesQueueSize=0,this.callback=null}set(t,e,i){null!=i&&this.stylesUrlMap.set(t,i),this.stylesMap.set(t,e)}get(t){return this.stylesMap.get(t)}contains(t){return this.stylesMap.contains(t)}done(t){this.callback=t,this.doCallback(this)}doCallback(t){if(null!==tmo.callback&&void 0!==t.callback&&t.stylesQueueSize===t.stylesMap.size()){var e=t.callback;t.callback=null,e.call()}}load(t,e){return this.stylesQueueSize++,new Promise((i=>{P.get(e).then((s=>{if(!s.ok)throw"Unable to load styles for "+t+" at "+e;s.text().then((s=>{this.set(t,new V(s),e),this.doCallback(this),i()}))}))}))}getStylesLoadedPromise(t){return new Promise(((e,i)=>{var s=0;t&&0!=t.size()?t.forEach(((n,r,a)=>this.contains(n)?++s!=t.size()||(e(),!1):(this.privateLoad(n,M.parse(r)).then((()=>{if(++s==t.size())return e(),!1})).catch((t=>(i(t),!1))),!0)),this):e()}))}privateLoad(t,e){return R.info("Loading styles "+t+" at "+e.toString()),new Promise((i=>{P.get(e).then((s=>{if(!s.ok)throw"Unable to load styles for "+t+" at "+e;s.text().then((s=>{this.set(t,new V(s),e),i()}))}))}))}}class N{constructor(t){this.templateSource=t}getTemplateSource(){return this.templateSource}}const U=new a("TemplateRegistry");class O{constructor(){this.templateMap=new r,this.templateUrlMap=new r,this.templateQueueSize=0,this.callback=null,this.languagePrefix=null}setLanguagePrefix(t){this.languagePrefix=t}set(t,e,i){null!=i&&this.templateUrlMap.set(t,i),this.templateMap.set(t,e)}get(t){return this.templateMap.get(t)}contains(t){return this.templateMap.contains(t)}done(t){this.callback=t,this.doCallback(this)}doCallback(t){if(null!==tmo.callback&&void 0!==t.callback&&t.templateQueueSize===t.templateMap.size()){var e=t.callback;t.callback=null,e.call()}}load(t,e){return null!==this.languagePrefix&&e.pathsList.setLast(this.languagePrefix+"."+e.pathsList.getLast()),this.templateQueueSize++,new Promise((i=>{P.get(e).then((s=>{if(!s.ok)throw"Unable to load template for "+t+" at "+e;s.text().then((s=>{this.set(t,new N(s),e),this.doCallback(this),i()}))}))}))}getTemplatesLoadedPromise(t){return new Promise(((e,i)=>{var s=0;t&&0!=t.size()?t.forEach(((n,r,a)=>this.contains(n)?++s!=t.size()||(e(),!1):(this.privateLoad(n,M.parse(r)).then((()=>{if(++s==t.size())return e(),!1})).catch((t=>(i(t),!1))),!0)),this):e()}))}privateLoad(t,e){return null!==this.languagePrefix&&e.pathsList.setLast(this.languagePrefix+"."+e.pathsList.getLast()),U.info("Loading template "+t+" at "+e.toString()),new Promise((i=>{P.get(e).then((s=>{if(!s.ok)throw"Unable to load template for "+t+" at "+e;s.text().then((s=>{this.set(t,new N(s),e),i()}))}))}))}}new a("TemplatePostConfig");class I{constructor(t){this.templateRegistry=t}load(t){let e=new r;return t.forEach(((t,i,s)=>(i.classReference.TEMPLATE_URL&&i.classReference.COMPONENT_NAME&&e.set(i.classReference.COMPONENT_NAME,i.classReference.TEMPLATE_URL),!0)),this),this.templateRegistry.getTemplatesLoadedPromise(e)}}new a("StylesLoader");class F{constructor(t){this.stylesRegistry=t}load(t){let e=new r;return t.forEach(((t,i,s)=>(i.classReference.STYLES_URL&&i.classReference.COMPONENT_NAME&&e.set(i.classReference.COMPONENT_NAME,i.classReference.STYLES_URL),!0)),this),this.stylesRegistry.getStylesLoadedPromise(e)}}new a("ComponentConfigProcessor");class H{constructor(){this.templateRegistry=u.instance(O),this.stylesRegistry=u.instance(A)}postConfig(){this.templatesLoader=new I(this.templateRegistry),this.stylesLoader=new F(this.stylesRegistry)}processConfig(t,e){return Promise.all([this.templatesLoader.load(e),this.stylesLoader.load(e)])}}class z{constructor(t){this.attribute=t}get value(){return this.attribute.value}get name(){return this.attribute.name}get namespace(){return this.attribute.name}}const B=new a("BaseElement");class _{constructor(t,e){this.element=null,this.attributeMap=null,this.eventsAttached=new n,t instanceof v?this.element=this.createFromXmlElement(t,e):"string"!=typeof t?i.isUIElement(t)?this.element=t:(B.error("Unrecognized value for Element"),B.error(t)):this.element=i.createElement(t)}loadAttributes(){if(null!==this.element.attributes&&void 0!==this.element.attributes){if(null===this.attributeMap||void 0===this.attributeMap){this.attributeMap=new r;for(var t=0;t<this.element.attributes.length;t++)this.attributeMap.set(this.element.attributes[t].name,new z(this.element.attributes[t]))}}else this.attributeMap=new r}createFromXmlElement(t,e){let s=null;return s=t.namespace?i.createElementNS(t.namespaceUri,t.fullName):i.createElement(t.name),e&&null!==e.mappedElement&&i.appendChild(e.mappedElement,s),t.attributes.forEach(((t,e)=>(i.setAttribute(s,t,e.value),!0))),s}attachEvent(t,e,s=!1){this.eventsAttached.contains(t)?B.warn("Event '"+t+"' allready attached for "+this.element.name):(t.startsWith("on")&&(t=t.substr(2)),i.addEventListener(this.element,t,e,s),this.eventsAttached.add(t))}listenTo(t,e,s){i.addEventListener(this.element,t,(t=>{e.call(new G(t))}),s)}get mappedElement(){return this.element}get fullName(){return this.element.tagName}get top(){return this.element.getBoundingClientRect().top}get bottom(){return this.element.getBoundingClientRect().bottom}get left(){return this.element.getBoundingClientRect().left}get right(){return this.element.getBoundingClientRect().right}get width(){return this.element.offsetWidth}get height(){return this.element.offsetHeight}get attributes(){return this.loadAttributes(),this.attributeMap}setAttributeValue(t,e){i.setAttribute(this.element,t,e)}getAttributeValue(t){return i.getAttribute(this.element,t)}containsAttribute(t){return this.element.hasAttribute(t)}removeAttribute(t){this.element.removeAttribute(t)}setStyle(t,e){this.element.style[t]=e}getStyle(t){return this.element.style[t]}removeStyle(t){this.element.style[t]=null}set(t){if(null!==this.element.parentNode){if(!t.mappedElement)return t&&null!==t.rootElement?(this.element.parentNode.replaceChild(t.rootElement.mappedElement,this.element),void(this.element=t.rootElement.mappedElement)):void("string"!=typeof t?(t instanceof Text||t instanceof Element)&&this.element.parentNode.replaceChild(t,this.element):this.element.parentNode.replaceChild(i.createTextNode(t),this.element));this.element.parentNode.replaceChild(t.mappedElement,this.element)}else console.error("The element has no parent, can not swap it for value")}isMounted(){return!!this.element.parentNode}remove(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}clear(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild)}setChild(t){this.clear(),this.addChild(t)}addChild(t){void 0===t.mappedElement||null===t.mappedElement?t&&t.rootElement?this.element.appendChild(t.rootElement.mappedElement):"string"!=typeof t?(t instanceof Text||t instanceof Element)&&this.element.appendChild(t):this.element.appendChild(i.createTextNode(t)):this.element.appendChild(t.mappedElement)}prependChild(t){null===this.element.firstChild&&this.addChild(t),void 0===t.mappedElement||null===t.mappedElement?t&&t.rootElement?this.element.insertBefore(t.rootElement.mappedElement,this.element.firstChild):"string"!=typeof t?(t instanceof Text||t instanceof Element)&&this.element.insertBefore(t,this.element.firstChild):this.element.insertBefore(i.createTextNode(t),this.element.firstChild):this.element.insertBefore(t.mappedElement,this.element.firstChild)}}new a("AbstractInputElement");class j extends _{constructor(t,e){super(t,e)}get name(){return this.element.name}set name(t){this.element.name=t}get value(){return this.backingValue}set value(t){this.element.value=t,this.element.dispatchEvent(new InputEvent("change"))}get backingValue(){return this.element.value}focus(){this.element.focus()}selectAll(){this.element.select()}enable(){this.element.disabled=!1}disable(){this.element.disabled=!0}}class W extends j{constructor(t,e){super(t,e)}set checked(t){this.element.checked=t}isChecked(){return this.element.checked}get value(){return this.isChecked()}set value(t){this.element.checked=!0===t||"true"===t}}class D extends j{constructor(t,e){super(t,e)}set checked(t){this.element.checked=t}isChecked(){return this.element.checked}get value(){return this.isChecked()}set value(t){this.element.checked=!0===t||"true"===t}}class X extends j{constructor(t,e){super(t,e)}}class q extends j{constructor(t,e){super(t,e)}get innerHTML(){return this.element.innerHTML}set innerHTML(t){this.element.innerHTML=t}addChild(t){super.addChild(t),this.value=this.innerHTML}prependChild(t){super.prependChild(t),this.value=this.innerHTML}}class Q{constructor(t,e){t instanceof w&&(this.element=this.createFromXmlCdata(t,e)),"string"==typeof t&&(this.element=i.createTextNode(t))}createFromXmlCdata(t,e){let s=document.createTextNode(t.value);return null!==e&&null!==e.mappedElement&&i.appendChild(e.mappedElement,s),s}set value(t){this.element=t}get value(){return this.element}get mappedElement(){return this.element}}class Y extends _{constructor(t,e){super(t,e)}get innerHTML(){return this.element.innerHTML}set innerHTML(t){this.element.innerHTML=t}}class $ extends _{constructor(t,e){super(t,e)}get name(){return this.element.name}set name(t){this.element.name=t}submit(){return this.element.submit()}}class J extends _{constructor(t,e){super(t,e)}get mappedElement(){return this.element}play(){this.element.play()}mute(){this.element.muted=!0}unmute(){this.element.muted=!1}}class K{static map(t,e){return K.mapsToRadio(t)?new W(t,e):K.mapsToCheckbox(t)?new D(t,e):K.mapsToSubmit(t)?new X(t,e):K.mapsToForm(t)?new $(t,e):K.mapsToTextarea(t)?new q(t,e):K.mapsToText(t)?new X(t,e):K.mapsToVideo(t)?new J(t,e):K.mapsToTextnode(t)?new Q(t,e):(K.mapsToSimple(t)||console.log("Mapping to simple by default "+t),new Y(t,e))}static mapsToRadio(t){return t instanceof HTMLInputElement&&"radio"===t.type||t instanceof v&&"input"===t.name&&t.getAttribute("type")&&"radio"===t.getAttribute("type").value}static mapsToCheckbox(t){return t instanceof HTMLInputElement&&"checkbox"===t.type||t instanceof v&&"input"===t.name&&t.getAttribute("type")&&"checkbox"===t.getAttribute("type").value}static mapsToSubmit(t){return t instanceof HTMLInputElement&&"submit"===t.type||t instanceof v&&"input"===t.name&&t.getAttribute("type")&&"submit"===t.getAttribute("type").value}static mapsToForm(t){return t instanceof HTMLFormElement||t instanceof v&&"form"===t.name}static mapsToText(t){if(t instanceof HTMLInputElement){if("text"===t.type)return!0;if("password"===t.type)return!0;if("email"===t.type)return!0;if("date"===t.type)return!0;if("time"===t.type)return!0}if(t instanceof v&&"input"===t.name){if(!t.getAttribute("type"))return!0;if("text"===t.getAttribute("type").value)return!0;if("password"===t.getAttribute("type").value)return!0;if("email"===t.getAttribute("type").value)return!0;if("date"===t.getAttribute("type").value)return!0;if("time"===t.getAttribute("type").value)return!0}return!1}static mapsToTextnode(t){return t instanceof Node&&"TEXT_NODE"===t.nodeType||t instanceof w}static mapsToVideo(t){return t instanceof HTMLVideoElement||t instanceof v&&"video"===t.name}static mapsToTextarea(t){return t instanceof HTMLTextAreaElement||t instanceof v&&"textarea"===t.name}static mapsToSimple(t){return t instanceof HTMLElement||t instanceof v}}class G{constructor(t){this.event=t,"dragstart"==this.event.type.toLowerCase()&&this.event.dataTransfer.setData("text/plain",null)}stopPropagation(){this.event.stopPropagation()}preventDefault(){this.event.preventDefault()}getOffsetX(){return this.event.offsetX}getOffsetY(){return this.event.offsetY}getClientX(){return this.event.clientX}getClientY(){return this.event.clientY}getTarget(){if(this.event&&this.event.target)return K.map(this.event.target)}getRelatedTarget(){return this.event&&this.event.relatedTarget?K.map(this.event.relatedTarget):null}getRelatedTargetAttribute(t){return this.event.relatedTarget?K.map(this.event.relatedTarget).getAttributeValue(t):null}getTargetValue(){return this.getTarget()?this.getTarget().value:null}getKeyCode(){return this.event.keyCode}isKeyCode(t){return this.event.keyCode===t}}new a("EventRegistry");class Z{constructor(){this.listeners=new r}attach(t,e,i,s,n=!1){const r=i+"_"+s,a=this;t.attachEvent(e,(function(t){a.trigger(r,t)}),n)}listen(t,e,i){this.initMap(t+"_"+i).set(e.object.constructor.name,e)}initMap(t){return this.listeners.exists(t)||this.listeners.set(t,new r),this.listeners.get(t)}trigger(t,e){this.listeners.exists(t)&&this.listeners.get(t).forEach(((t,i,s)=>(i.call(new G(e)),!0)),this)}}class tt{idAttributeWithSuffix(t){if(et.contains(t)){var e=et.get(t);return et.set(t,e+1),t+"-"+e}return et.set(t,1),t}}var et=new r;class it{constructor(t,e,i){this.componentIndex=t,this.elementMap=i,this.rootElement=e}remove(){this.rootElement.remove()}get(t){return this.elementMap.get(t)}set(t,e){return this.elementMap.get(t).set(e),this.elementMap.get(t)}clearChildren(t){return this.elementMap.get(t).clear(),this.elementMap.get(t)}setChild(t,e){return this.elementMap.get(t).setChild(e),this.elementMap.get(t)}addChild(t,e){return this.elementMap.get(t).addChild(e),this.elementMap.get(t)}prependChild(t,e){return this.elementMap.get(t).prependChild(e),this.elementMap.get(t)}}class st{constructor(t,e,i){this.componentIndex=i,this.uniqueIdRegistry=e,this.eventRegistry=t,this.rootElement=null,this.elementMap=new r}getElementMap(){return this.elementMap}elementCreated(t,e){var i=K.map(t,e);return this.addToElementIdMap(i),this.registerElementEvents(i),null===this.rootElement&&null!==i&&(this.rootElement=i),i}registerElementEvents(t){if(null!=t&&t instanceof _){var e=this.eventRegistry,i=this.componentIndex;t.attributes.forEach((function(s,n,r){if(null!=n&&n.value.startsWith("//event:")){var a=n.value,l=n.name;e.attach(t,l,a,i)}return!0}),this)}}addToElementIdMap(t){if(null!=t&&t instanceof _){var e=null;t.containsAttribute("id")&&(e=t.getAttributeValue("id"),t.setAttributeValue("id",this.uniqueIdRegistry.idAttributeWithSuffix(e))),null!==e&&this.elementMap.set(e,t)}}}class nt{static shouldSwallowNextFocusEscape=!1;static replaceComponent(t,e){const s=i.getElementById(t);s.parentNode.replaceChild(e.rootElement.mappedElement,s)}static setComponent(t,e){const s=i.getElementById(t);s.innerHTML="",s.appendChild(e.rootElement.mappedElement,s)}static addChildComponent(t,e){i.getElementById(t).appendChild(e.rootElement.mappedElement)}static addChildElement(t,e){i.getElementById(t).appendChild(e.mappedElement)}static removeElement(t){i.removeElement(t)}static addHeaderElement(t){i.appendRootMetaChild(t.mappedElement)}static addBodyElement(t){i.appendRootUiChild(t.mappedElement)}static prependHeaderElement(t){i.prependElement("head",t.mappedElement)}static prependBodyElement(t){i.prependElement("body",t.mappedElement)}static listenToFocusEscape(t,e){const n=new l(null,(s=>{i.contains(e.element,s.getTarget().element)||nt.shouldSwallowNextFocusEscape||t.call(s)}));s.addEventListener("click",n,G)}static swallowFocusEscape(t){nt.shouldSwallowNextFocusEscape=!0,setTimeout((()=>{nt.shouldSwallowNextFocusEscape=!1}),t)}}class rt{static custom(t){var e=new v(t);return K.map(e)}static applyStyles(t,e,i){e&&t.setAttributeValue("class",e),i&&t.setAttributeValue("style",i)}static a(t,e,i,s){var n=rt.custom("a");return n.addChild(t),n.setAttributeValue("href",e),rt.applyStyles(n,i,s),n}static i(t,e,i){var s=rt.custom("i");return s.addChild(t),rt.applyStyles(s,e,i),s}}const at=new a("CanvasStyles"),lt=new r,ot=new r,ht=new n;class ut{static setStyle(t,e){if(lt.contains(t))lt.get(t).setChild(new Q(e.getStylesSource()));else{let i=rt.custom("style");i.setAttributeValue("id",t),i.setChild(new Q(e.getStylesSource())),lt.set(t,i)}}static removeStyle(t){ht.contains(t)&&(ht.remove(t),nt.removeElement(t)),lt.contains(t)&&lt.remove(t)}static disableStyle(t,e=0){ut.removeStyleOwner(t,e),ut.hasStyleOwner(t)||(lt.contains(t)?ht.contains(t)&&(ht.remove(t),nt.removeElement(t)):at.error("Style does not exist: "+t))}static enableStyle(t,e=0){ut.addStyleOwner(t,e),lt.contains(t)?ht.contains(t)||(ht.add(t),nt.addHeaderElement(lt.get(t))):at.error("Style does not exist: "+t)}static addStyleOwner(t,e){ot.contains(t)||ot.set(t,new n),ot.get(t).contains(e)||ot.get(t).add(e)}static removeStyleOwner(t,e){ot.contains(t)&&ot.get(t).remove(e)}static hasStyleOwner(t){return!!ot.contains(t)&&ot.get(t).size()>0}}const ct=new a("ComponentFactory");class dt{constructor(){this.eventRegistry=u.instance(Z),this.stylesRegistry=u.instance(A),this.templateRegistry=u.instance(O),this.uniqueIdRegistry=u.instance(tt)}create(t){var e=this.templateRegistry.get(t);if(!e)throw ct.error(this.templateRegistry),"No template was found with name "+t;var i=new st(this.eventRegistry,this.uniqueIdRegistry,pt++);return new y(e.getTemplateSource(),i).load(),this.mountStyles(t),new it(i.componentIndex,i.rootElement,i.getElementMap())}mountStyles(t){this.stylesRegistry.contains(t)&&ut.setStyle(t,this.stylesRegistry.get(t))}}var pt=0;new a("Config");class mt{static getInstance(){return gt}constructor(){this.typeConfigList=new n([c.unnamed(O),c.unnamed(A),c.unnamed(tt),c.unnamed(dt),d.unnamed(Z)])}getTypeConfigList(){return this.typeConfigList}}const gt=new mt,ft=new a("LoaderInterceptor");class vt{process(){return ft.info("Unimplemented Loader Interceptor breaks by default"),!1}}const wt=new a("ModuleLoader");class yt{constructor(t,e,i=[]){this.matchPath=t,this.modulePath=e,this.loaderInterceptors=i}matches(t){return!this.matchPath||(t?o.nonNullEquals(this.matchPath,t.path):(wt.error("Url is null"),!1))}load(){return this.importModule().then((t=>this.interceptorsPass().then((()=>t)).catch((t=>{wt.warn("Filter rejected "+t)}))))}interceptorsPass(){const t=this.loaderInterceptors;if(t&&t.length>0){let e=t[0].process();for(let i=1;i<t.length;i++)e=e.then(t[i]);return e}return Promise.resolve()}importModule(){return new Promise(((t,e)=>{import(this.modulePath).then((e=>{t(new e.default)})).catch((t=>{e(t)}))}))}}class Et{load(t){throw"Main class must implement load(url)"}update(){throw"Main class must implement update()"}get path(){throw"Main class must implement get path()"}}const bt=new a("DiModuleLoader");class Mt extends yt{constructor(t,e,i,s=[]){super(e,i,s),this.config=t}load(){return this.importModule().then((t=>this.interceptorsPass().then((()=>p.inject(t,this.config))).catch((t=>{throw bt.warn("Filter rejected "+t),t})))).catch((t=>{throw t}))}importModule(){return new Promise(((t,e)=>super.importModule().then((i=>{this.config.addAllTypeConfig(i.typeConfigList),this.config.finalize().then((()=>{new n(this.loaderInterceptors).promiseChain((t=>p.inject(t,this.config))).then((()=>{t(i)})).catch((t=>{e(t)}))})).catch((t=>{e(t)}))})).catch((t=>{e(t)}))))}}const Tt=new a("Application");class Lt extends E{constructor(){super(),this.workerList=new n,this.moduleLoaderList=new n,this.config=new m,this.runningWorkers=new n,this.activeMain=null,this.defaultConfig=mt.getInstance().getTypeConfigList(),this.defaultConfigProcessors=new n([H]),this.defaultInstanceProcessors=new n([g]),this.customConfig=new n}set customTypeConfig(t){this.customConfig=t}run(){Tt.info("Running Application"),this.config.addAllTypeConfig(this.defaultConfig).addAllTypeConfig(this.customConfig).addAllConfigProcessor(this.defaultConfigProcessors).addAllInstanceProcessor(this.defaultInstanceProcessors),k.instance().set(this),t.addUserNavigateListener(new l(this,this.update),G),this.runModule(T.currentUrl()).then((()=>{this.startWorkers()}))}update(t){const e=T.currentUrl();this.activeMain&&o.nonNullEquals(this.activeMain.path,e.path)?this.activeMain.update(e):this.runModule(e)}runModule(t){return this.getMatchingModuleLoader(t).load().then((e=>{this.activeMain=e,e.load(t,null)})).catch((t=>{Tt.error(t)}))}startWorkers(){this.runningWorkers.size()>0||this.workerList.forEach(((t,e)=>{const i=new t;return p.inject(i,this.config),this.runningWorkers.add(i),!0}),this)}getMatchingModuleLoader(t){let e=null;return this.moduleLoaderList.forEach(((i,s)=>!i.matches(t)||(e=i,!1)),this),e}windowDiConfig(){window.diConfig=()=>{Tt.info(this.config.configEntries)}}windowTemplateRegistry(){window.templateRegistry=()=>{Tt.info(f.instanceHolder(O.name,this.config).instance)}}windowStyleRegistry(){window.styleRegistry=()=>{Tt.info(f.instanceHolder(A.name,this.config).instance)}}}new a("InputElementDataBinding");class St{constructor(t,e){this.model=t,this.validator=e,this.pullers=new n,this.pushers=new n}static link(t,e){return new St(t,e)}and(t){return this.to(t)}to(t){const e=()=>{h.getValue(this.model,t.name)!==t.value&&h.setValue(this.model,t.name,t.value),this.validator&&this.validator.validate&&this.validator.validate(t.value)};t.attachEvent("onchange",e),t.attachEvent("onkeyup",e),e.call();let i="__changed_"+t.name.replace(".","_");return this.model[i]||(this.model[i]=()=>{this.push()}),this.pullers.add(e),this.pushers.add((()=>{var e=h.getValue(this.model,t.name);e!==t.value&&(t.value=e),this.validator&&this.validator.validateSilent&&t.value&&this.validator.validateSilent(t.value)})),this}pull(){this.pullers.forEach(((t,e)=>(t.call(e),!0)),this)}push(){this.pushers.forEach(((t,e)=>(t.call(e),!0)),this)}}class Ct{static createProxyObject(t){return new Proxy(t,{set:(t,e,i)=>{let s=t[e]=i,n=t["__changed_"+e];if(n&&"function"==typeof n){n.bind(t)()}return s===i}})}}class xt extends l{constructor(t,e){this.objectFunction=t,this.filter=e}call(t){this.filter&&this.filter.call(this,t)&&this.objectFunction.call(t)}}class kt{constructor(){this.trail=null,this.property=null,this.waypoint=null,this.destination=null,this.next=null}}class Pt{static navigateAllStops(t,e,i){const s=Pt.callMatchingFunctionFromUrl(t,e,i);if(!s||0===s.size())return;const n=L.builder().withAllOfUrl(T.currentUrl()),r=n.withBookmark(null).build();T.replaceUrl(r,r.toString(),null),s.forEach((t=>{const e=n.withBookmark(t).build();return T.pushUrl(e,e.toString(),t),!0}),this)}static navigateNextStop(t,e,i){Pt.callMatchingFunctionFromUrl(t,e,i)}static identifyStop(t,e,i){const s=T.currentUrl(),n=Pt.getNodeByFunction(i,t);if(!n)return Promise.resolve();const r=n.destination.call(e),a=L.builder().withAllOfUrl(s);if(o.isBlank(s.bookmark)){const t=a.withBookmark("/").build();T.pushUrl(t,t.toString(),null)}const l=a.withBookmark(n.trail).build();return T.pushUrl(l,l.toString(),null),r}static getNodeByFunction(t,e){if(e===t.destination)return t;if(t.next){let i=null;if(t.next.forEach((t=>{i||(i=Pt.getNodeByFunction(t,e))})),i)return i}return null}static callMatchingFunctionFromUrl(t,e,i,s=new n){return i.property&&(e=e[i.property]),o.startsWith(t.bookmark,Pt.toStartsWith(i.trail))&&(s.add(i.trail),i.waypoint&&i.waypoint.call(e)),o.nonNullEquals(t.bookmark,i.trail)&&(s.add(i.trail),i.destination&&i.destination.call(e)),i.next&&i.next.forEach((i=>{s=Pt.callMatchingFunctionFromUrl(t,e,i,s)})),s}static toStartsWith(t){return null==t||o.nonNullEquals(t,"/")?"/":t+"/"}}new a("HttpCallBuilder");class Vt{constructor(t,e){this.url=t,this.payload=e,this.authorization=null,this.successMappingMap=new r,this.failMappingMap=new r,this.errorMappingFunction=t=>t,this.connectionTimeoutValue=4e3,this.responseTimeoutValue=4e3}static newInstance(t,e){return new Vt(t,e)}successMapping(t,e=(()=>null)){return this.successMappingMap.set(t,e),this}failMapping(t,e=(()=>null)){return this.failMappingMap.set(t,e),this}errorMapping(t){return this.errorMappingFunction=t,this}authorizationHeader(t){return this.authorization="Bearer "+t,this}connectionTimeout(t){this.connectionTimeoutValue=t}responseTimeout(t){this.responseTimeoutValue=t}get(){return this.asTypeMappedPromise(P.get(this.url,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization))}post(){return this.asTypeMappedPromise(P.post(this.url,this.payload,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization))}put(){return this.asTypeMappedPromise(P.put(this.url,this.payload,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization))}patch(){return this.asTypeMappedPromise(P.patch(this.url,this.payload,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization))}delete(){return this.asTypeMappedPromise(P.delete(this.url,this.connectionTimeoutValue,this.responseTimeoutValue))}asTypeMappedPromise(t){return new Promise(((e,i)=>{t.then((t=>{this.handleFetchResponse(t,e,i)})).catch((t=>{i(this.errorMappingFunction(t))}))}))}handleFetchResponse(t,e,i){const s=this.successMappingMap.get(t.status),n=this.failMappingMap.get(t.status);if(204===t.status||"0"===t.headers.get("Content-Length"))return s?void e(s(null)):n?void i(n(null)):void i(new Error("Missing mapper for return status: "+t.status));t.json().then((t=>{s?e(s(t)):i(n?n(t):this.errorMappingFunction(t))})).catch((t=>{i(this.errorMappingFunction(t))}))}}const Rt=new a("AbstractValidator");class At{constructor(t=!1,e=!0){this.validListenerList=new n,this.invalidListenerList=new n,this.currentlyValid=t,this.enabled=e}enable(){this.enabled=!0,this.isValid()?this.valid():this.invalid()}disable(){let t=this.currentlyValid;this.valid(),this.enabled=!1,this.currentlyValid=t}isValid(){return!this.enabled||this.currentlyValid}valid(){this.enabled&&(this.currentlyValid=!0,this.validListenerList?this.validListenerList.forEach(((t,e)=>(t.call(),!0)),this):Rt.warn("No validation listeners"))}invalid(){this.enabled&&(this.currentlyValid=!1,this.invalidListenerList?this.invalidListenerList.forEach(((t,e)=>(t.call(),!0)),this):Rt.warn("No invalidation listeners"))}validSilent(){this.currentlyValid=!0}invalidSilent(){this.currentlyValid=!1}withValidListener(t){return this.validListenerList.add(t),this}withInvalidListener(t){return this.invalidListenerList.add(t),this}}class Nt extends At{constructor(t=!1){super(t),this.validatorList=new n}withValidator(t){return t.withValidListener(new l(this,this.oneValid)),t.withInvalidListener(new l(this,this.oneInvalid)),this.validatorList.add(t),this}oneValid(){let t=!1;this.validatorList.forEach(((e,i)=>!!e.isValid()||(t=!0,!1)),this),t?super.invalid():super.valid()}oneInvalid(){super.invalid()}}class Ut extends At{constructor(t=!1,e=!1,i="(.*)"){super(e),this.mandatory=t,this.regex=i}validate(t){t&&"string"==typeof t&&t.match(this.regex)?this.valid():t||this.mandatory?this.invalid():this.valid()}validateSilent(t){t&&"string"==typeof t&&t.match(this.regex)?this.validSilent():t||this.mandatory?this.invalidSilent():this.validSilent()}}const Ot=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;class It extends Ut{constructor(t=!1,e=!1){super(t,e,Ot)}}class Ft extends At{constructor(t=!1,e=!1,i=null){super(e),this.mandatory=t,this.comparedValueFunction=i}validate(t){!t&&this.mandatory?this.invalid():t===this.comparedValueFunction.call()?this.valid():this.invalid()}validateSilent(t){!t&&this.mandatory?this.invalidSilent():t===this.comparedValueFunction.call()?this.validSilent():this.invalidSilent()}}class Ht extends At{constructor(t=!1,e=!1,i=null,s=null){super(e),this.mandatory=t,this.model=i,this.attributeName=s}validate(t){!t&&this.mandatory?this.invalid():t===h.getValue(this.model,this.attributeName)?this.valid():this.invalid()}validateSilent(t){!t&&this.mandatory?this.invalidSilent():t===h.getValue(this.model,this.attributeName)?this.validSilent():this.invalidSilent()}}class zt extends At{constructor(t=!1,e=!1,i=null){super(e),this.mandatory=t,this.controlValue=i}validate(t){!t&&this.mandatory?this.invalid():t===controlValue?this.valid():this.invalid()}validateSilent(t){!t&&this.mandatory?this.invalidSilent():t===controlValue?this.validSilent():this.invalidSilent()}}class Bt extends At{constructor(t=!1){super(t),this.validatorList=new n}withValidator(t){return t.withValidListener(new l(this,this.oneValid)),t.withInvalidListener(new l(this,this.oneInvalid)),this.validatorList.add(t),this}oneValid(){super.valid()}oneInvalid(){let t=!1;this.validatorList.forEach(((e,i)=>!e.isValid()||(t=!0,!1)),this),t?super.valid():super.invalid()}}const _t=/^(?=.*[A-Za-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;class jt extends Ut{constructor(t=!1,e=!1){super(t,e,_t)}}const Wt=/^\+[0-9]{2}\s?([0-9]\s?)*$/;class Dt extends Ut{constructor(t=!1,e=!1){super(t,e,Wt)}}class Xt extends At{constructor(t=!1,e=!0){super(t,e)}validate(t){""===t?this.invalid():this.valid()}validateSilent(t){""===t?this.invalidSilent():this.validSilent()}}export{j as AbstractInputElement,At as AbstractValidator,k as ActiveModuleRunner,Nt as AndValidatorSet,Lt as Application,z as Attribute,_ as BaseElement,nt as CanvasRoot,ut as CanvasStyles,D as CheckboxInputElement,P as Client,it as Component,H as ComponentConfigProcessor,dt as ComponentFactory,mt as Config,Mt as DiModuleLoader,K as ElementMapper,st as ElementRegistrator,It as EmailValidator,Ft as EqualsFunctionResultValidator,Ht as EqualsPropertyValidator,zt as EqualsStringValidator,G as Event,xt as EventFilteredObjectFunction,Z as EventRegistry,$ as FormElement,rt as HTML,T as History,Vt as HttpCallBuilder,St as InputElementDataBinding,vt as LoaderInterceptor,Et as Main,yt as ModuleLoader,E as ModuleRunner,C as Navigation,Bt as OrValidatorSet,jt as PasswordValidator,Dt as PhoneValidator,Ct as ProxyObjectFactory,W as RadioInputElement,Ut as RegexValidator,Xt as RequiredValidator,Y as SimpleElement,V as Styles,F as StylesLoader,A as StylesRegistry,N as Template,O as TemplateRegistry,I as TemplatesLoader,X as TextInputElement,q as TextareaInputElement,Q as TextnodeElement,kt as TrailNode,Pt as TrailProcessor,tt as UniqueIdRegistry,b as Url,L as UrlBuilder,M as UrlUtils,J as VideoElement};
