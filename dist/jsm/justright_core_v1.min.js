import{List as e,Map as t,Logger as s,PropertyAccessor as i,ObjectFunction as n}from"./coreutil_v1.js";import{InjectionPoint as r,SingletonConfig as a,PrototypeConfig as l,MindiConfig as o,InstancePostConfigTrigger as h,MindiInjector as c,ConfigAccessor as u}from"./mindi_v1.js";import{ContainerHttpClient as d,ContainerUrl as m,ContainerElement as p}from"./containerbridge_v1.js";import{XmlElement as g,XmlCdata as f,DomTree as v}from"./xmlparser_v1.js";class y{static get(e,t=4e3,s=4e3){return d.fetch(e.toString(),{method:"GET",mode:"cors",redirect:"follow"},t,s)}static post(e,t,s=4e3,i=4e3,n=null){let r=y.getHeader(n);var a={body:JSON.stringify(t),headers:r,method:"POST",mode:"cors",redirect:"follow"};return d.fetch(e.toString(),a,s,i)}static put(e,t,s=4e3,i=4e3,n=null){let r=y.getHeader(n);var a={body:JSON.stringify(t),method:"PUT",mode:"cors",redirect:"follow",headers:r};return d.fetch(e.toString(),a,s,i)}static patch(e,t,s=4e3,i=4e3,n=null){let r=y.getHeader(n);var a={body:JSON.stringify(t),method:"PATCH",mode:"cors",redirect:"follow",headers:r};return d.fetch(e.toString(),a,s,i)}static delete(e,t=4e3,s=4e3){return d.fetch(e.toString(),{method:"DELETE",mode:"cors",redirect:"follow"},t,s)}static getHeader(e=null){let t={"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"};return e&&(t={"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json",Authorization:e}),t}}class w{constructor(s){if(this.protocol=null,this.host=null,this.port=null,this.pathList=new e,this.parameterMap=new t,this.bookmark=null,null!==s){var i=this.determineProtocol(s);null!==i&&(null!==this.protocol&&(i=this.determineHost(i)),null!==i&&(null!==this.host&&(i=this.determinePort(i)),null!==i&&null!==(i=this.determinePath(i))&&null!==(i=this.determineParameters(i))&&this.determineBookmark(i)))}}getProtocol(){return this.protocol}getHost(){return this.host}getPort(){return this.port}getPathList(){return this.pathList}getPathPart(e){return this.pathList.get(e)}getPath(){let e="/",t=!0;return this.pathList.forEach((s=>{t||(e+="/"),e+=s,t=!1}),this),e}clearPathList(){this.pathList=new e}getParameterMap(){return this.parameterMap}clearParameterMAp(){this.parameterMap=new t}getParameter(e){return this.parameterMap.get(e)}setParameter(e,t){this.parameterMap.set(e,t)}setBookmark(e){this.bookmark=e}setPath(e){this.determinePath(e)}setQueryString(e){this.parameterMap=this.determineParameters(e)}getBookmark(){return this.bookmark}determineProtocol(e){if(-1===e.indexOf("//"))return e;var t=e.split("//");return-1!==t[0].indexOf("/")?e:(this.protocol=t[0],1==t.length?null:e.replace(t[0]+"//",""))}determineHost(e){var t=e.split("/"),s=t[0];return-1!==s.indexOf(":")&&(s=s.split(":")[0]),this.host=s,t.length>1?e.replace(s,""):null}determinePort(e){if(!e.startsWith(":"))return e;var t=e.split("/")[0].substring(1);return this.port=t,e.replace(":"+t,"")}determinePath(t){var s=t;if(-1!==t.indexOf("?"))(i=t.split("?")).length>1&&(s=t.substring(t.indexOf("?"))),t=i[0];else if(-1!==t.indexOf("#")){var i;(i=t.split("#")).length>1&&(s=t.substring(t.indexOf("#"))),t=i[0]}t.startsWith("/")&&(t=t.substring(1));var n=new e(t.split("/"));return this.pathList=new e,n.forEach((function(e,t){return t.pathList.add(decodeURI(e)),!0}),this),s}determineParameters(s){var i=s;if(-1===s.indexOf("?"))return s;-1!==(s=s.substring(s.indexOf("?")+1)).indexOf("#")&&(i=s.substring(s.indexOf("#")),s=s.substring(0,s.indexOf("#")));var n=new e(s.split("&")),r=new t;return n.forEach((function(e,t){var s=e.split("=");return s.length>=2&&r.set(decodeURI(s[0]),decodeURI(s[1])),!0}),this),this.parameterMap=r,i}determineBookmark(e){-1!==e.indexOf("#")&&(this.bookmark=e.substring(e.indexOf("#")+1))}toString(){var e="";null!==this.protocol&&(e=e+this.protocol+"//"),null!==this.host&&(e+=this.host),null!==this.port&&(e=e+":"+this.port),this.pathList.forEach((function(t,s){return e=e+"/"+t,!0}),this);var t=!0;return this.parameterMap.forEach((function(s,i,n){t?(t=!1,e+="?"):e+="&",e=e+encodeURI(s)+"="+encodeURI(i)}),this),null!==this.bookmark&&(e=e+"#"+this.bookmark),e}}class b{constructor(e){this.stylesSource=e}getStylesSource(){return this.stylesSource}}const E=new s("StylesRegistry");class L{constructor(){this.stylesMap=new t,this.stylesUrlMap=new t,this.stylesQueueSize=0,this.callback=null}set(e,t,s){null!=s&&this.stylesUrlMap.set(e,s),this.stylesMap.set(e,t)}get(e){return this.stylesMap.get(e)}contains(e){return this.stylesMap.contains(e)}done(e){this.callback=e,this.doCallback(this)}doCallback(e){if(null!==tmo.callback&&void 0!==e.callback&&e.stylesQueueSize===e.stylesMap.size()){var t=e.callback;e.callback=null,t.call()}}load(e,t){return this.stylesQueueSize++,new Promise((s=>{y.get(t).then((i=>{if(!i.ok)throw"Unable to load styles for "+e+" at "+t;i.text().then((i=>{this.set(e,new b(i),t),this.doCallback(this),s()}))}))}))}getStylesLoadedPromise(e){return new Promise(((t,s)=>{var i=0;e&&0!=e.size()?e.forEach(((n,r,a)=>this.contains(n)?++i!=e.size()||(t(),!1):(this.privateLoad(n,new w(r)).then((()=>{if(++i==e.size())return t(),!1})).catch((e=>(s(e),!1))),!0)),this):t()}))}privateLoad(e,t){return E.info("Loading styles "+e+" at "+t.toString()),new Promise((s=>{y.get(t).then((i=>{if(!i.ok)throw"Unable to load styles for "+e+" at "+t;i.text().then((i=>{this.set(e,new b(i),t),s()}))}))}))}}class M{constructor(e){this.templateSource=e}getTemplateSource(){return this.templateSource}}const C=new s("TemplateRegistry");class T{constructor(){this.templateMap=new t,this.templateUrlMap=new t,this.templateQueueSize=0,this.callback=null,this.languagePrefix=null}setLanguagePrefix(e){this.languagePrefix=e}set(e,t,s){null!=s&&this.templateUrlMap.set(e,s),this.templateMap.set(e,t)}get(e){return this.templateMap.get(e)}contains(e){return this.templateMap.contains(e)}done(e){this.callback=e,this.doCallback(this)}doCallback(e){if(null!==tmo.callback&&void 0!==e.callback&&e.templateQueueSize===e.templateMap.size()){var t=e.callback;e.callback=null,t.call()}}load(e,t){return null!==this.languagePrefix&&t.getPathList().setLast(this.languagePrefix+"."+t.getPathList().getLast()),this.templateQueueSize++,new Promise((s=>{y.get(t).then((i=>{if(!i.ok)throw"Unable to load template for "+e+" at "+t;i.text().then((i=>{this.set(e,new M(i),t),this.doCallback(this),s()}))}))}))}getTemplatesLoadedPromise(e){return new Promise(((t,s)=>{var i=0;e&&0!=e.size()?e.forEach(((n,r,a)=>this.contains(n)?++i!=e.size()||(t(),!1):(this.privateLoad(n,new w(r)).then((()=>{if(++i==e.size())return t(),!1})).catch((e=>(s(e),!1))),!0)),this):t()}))}privateLoad(e,t){return null!==this.languagePrefix&&t.getPathList().setLast(this.languagePrefix+"."+t.getPathList().getLast()),C.info("Loading template "+e+" at "+t.toString()),new Promise((s=>{y.get(t).then((i=>{if(!i.ok)throw"Unable to load template for "+e+" at "+t;i.text().then((i=>{this.set(e,new M(i),t),s()}))}))}))}}new s("TemplatePostConfig");class S{constructor(e){this.templateRegistry=e}load(e){let s=new t;return e.forEach(((e,t,i)=>(t.classReference.TEMPLATE_URL&&t.classReference.COMPONENT_NAME&&s.set(t.classReference.COMPONENT_NAME,t.classReference.TEMPLATE_URL),!0)),this),this.templateRegistry.getTemplatesLoadedPromise(s)}}new s("StylesLoader");class x{constructor(e){this.stylesRegistry=e}load(e){let s=new t;return e.forEach(((e,t,i)=>(t.classReference.STYLES_URL&&t.classReference.COMPONENT_NAME&&s.set(t.classReference.COMPONENT_NAME,t.classReference.STYLES_URL),!0)),this),this.stylesRegistry.getStylesLoadedPromise(s)}}new s("ComponentConfigProcessor");class k{constructor(){this.templateRegistry=r.instance(T),this.stylesRegistry=r.instance(L)}postConfig(){this.templatesLoader=new S(this.templateRegistry),this.stylesLoader=new x(this.stylesRegistry)}processConfig(e,t){return Promise.all([this.templatesLoader.load(t),this.stylesLoader.load(t)])}}class P{static replaceUrl(e,t,s){m.replaceUrl(e.toString(),t,s)}static pushUrl(e,t,s){m.pushUrl(e.toString(),t,s)}static getUrl(){return new w(m.currentUrl())}static loadUrl(e){m.loadUrl(e.toString())}}const A=new s("LoaderFilter");class V{process(){return A.info("Inumplemented Loader Filter breaks by default"),!1}}new s("ModuleLoader");class R{constructor(e,t,s,i=[]){this.matchPath=e,this.rootPath=t,this.modulePath=s,this.loaderFilters=i,this.defaultInstance=null,this.requestedPath=null}authorized(){return 0==this.requiredScopeArray.length}matches(){const e=P.getUrl();return this.matchPath.test(e.getPath())}load(e){if(!this.filtersPass())return;const t=this;t.defaultInstance?t.defaultInstance.load(e):t.importModule().then((()=>{t.defaultInstance.load(e)}))}filtersPass(){let e=!0;return this.loaderFilters&&this.loaderFilters.forEach((t=>{t.process()||(e=!1)})),e}importModule(){return new Promise(((e,t)=>{null==this.defaultInstance?import(this.modulePath).then((t=>{this.defaultInstance=new t.default,e()})).catch((e=>{t(e)})):e()}))}defaultInstance(){return this.defaultInstance}}class I{constructor(e){this.attribute=e}get value(){return this.attribute.value}get name(){return this.attribute.name}get namespace(){return this.attribute.name}}const N=new s("BaseElement");class H{constructor(t,s){this.element=null,this.attributeMap=null,this.eventsAttached=new e,t instanceof g?this.element=this.createFromXmlElement(t,s):"string"!=typeof t?t instanceof HTMLElement?this.element=t:(N.error("Unrecognized value for Element"),N.error(t)):this.element=p.createElement(t)}loadAttributes(){if(null!==this.element.attributes&&void 0!==this.element.attributes){if(null===this.attributeMap||void 0===this.attributeMap){this.attributeMap=new t;for(var e=0;e<this.element.attributes.length;e++)this.attributeMap.set(this.element.attributes[e].name,new I(this.element.attributes[e]))}}else this.attributeMap=new t}createFromXmlElement(e,t){let s=null;return s=e.namespace?p.createElementNS(e.namespaceUri,e.fullName):p.createElement(e.name),t&&null!==t.mappedElement&&t.mappedElement.appendChild(s),e.attributes.forEach((function(e,t){return s.setAttribute(e,t.value),!0})),s}attachEvent(e,t){this.eventsAttached.contains(e)?N.warn("Event '"+e+"' allready attached for "+this.element.name):(e.startsWith("on")&&(e=e.substr(2)),this.element.addEventListener(e,t),this.eventsAttached.add(e))}get mappedElement(){return this.element}get fullName(){return this.element.tagName}get top(){return this.element.getBoundingClientRect().top}get bottom(){return this.element.getBoundingClientRect().bottom}get left(){return this.element.getBoundingClientRect().left}get right(){return this.element.getBoundingClientRect().right}get width(){return this.element.offsetWidth}get height(){return this.element.offsetHeight}get attributes(){return this.loadAttributes(),this.attributeMap}setAttributeValue(e,t){this.element.setAttribute(e,t)}getAttributeValue(e){return this.element.getAttribute(e)}containsAttribute(e){return this.element.hasAttribute(e)}removeAttribute(e){this.element.removeAttribute(e)}setStyle(e,t){this.element.style[e]=t}getStyle(e){return this.element.style[e]}removeStyle(e){this.element.style[e]=null}set(e){if(null!==this.element.parentNode){if(!e.mappedElement)return e&&null!==e.rootElement?(this.element.parentNode.replaceChild(e.rootElement.mappedElement,this.element),void(this.element=e.rootElement.mappedElement)):void("string"!=typeof e?(e instanceof Text||e instanceof Element)&&this.element.parentNode.replaceChild(e,this.element):this.element.parentNode.replaceChild(p.createTextNode(e),this.element));this.element.parentNode.replaceChild(e.mappedElement,this.element)}else console.error("The element has no parent, can not swap it for value")}isMounted(){return!!this.element.parentNode}remove(){this.element.parentNode.removeChild(this.element)}clear(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild)}setChild(e){this.clear(),this.addChild(e)}addChild(e){void 0===e.mappedElement||null===e.mappedElement?e&&e.rootElement?this.element.appendChild(e.rootElement.mappedElement):"string"!=typeof e?(e instanceof Text||e instanceof Element)&&this.element.appendChild(e):this.element.appendChild(p.createTextNode(e)):this.element.appendChild(e.mappedElement)}prependChild(e){null===this.element.firstChild&&this.addChild(e),void 0===e.mappedElement||null===e.mappedElement?e&&e.rootElement?this.element.insertBefore(e.rootElement.mappedElement,this.element.firstChild):"string"!=typeof e?(e instanceof Text||e instanceof Element)&&this.element.insertBefore(e,this.element.firstChild):this.element.insertBefore(p.createTextNode(e),this.element.firstChild):this.element.insertBefore(e.mappedElement,this.element.firstChild)}}new s("AbstractInputElement");class O extends H{constructor(e,t){super(e,t)}get name(){return this.element.name}set name(e){this.element.name=e}get value(){return this.backingValue}set value(e){this.element.value=e,this.element.dispatchEvent(new InputEvent("change"))}get backingValue(){return this.element.value}focus(){this.element.focus()}selectAll(){this.element.select()}enable(){this.element.disabled=!1}disable(){this.element.disabled=!0}}class z extends O{constructor(e,t){super(e,t)}set checked(e){this.element.checked=e}isChecked(){return this.element.checked}get value(){return this.isChecked()}set value(e){this.element.checked=!0===e||"true"===e}}class F extends O{constructor(e,t){super(e,t)}set checked(e){this.element.checked=e}isChecked(){return this.element.checked}get value(){return this.isChecked()}set value(e){this.element.checked=!0===e||"true"===e}}class U extends O{constructor(e,t){super(e,t)}}class B extends O{constructor(e,t){super(e,t)}get innerHTML(){return this.element.innerHTML}set innerHTML(e){this.element.innerHTML=e}addChild(e){super.addChild(e),this.value=this.innerHTML}prependChild(e){super.prependChild(e),this.value=this.innerHTML}}class _{constructor(e,t){e instanceof f&&(this.element=this.createFromXmlCdata(e,t)),"string"==typeof e&&(this.element=p.createTextNode(e))}createFromXmlCdata(e,t){let s=document.createTextNode(e.value);return null!==t&&null!==t.mappedElement&&t.mappedElement.appendChild(s),s}set value(e){this.element=e}get value(){return this.element}get mappedElement(){return this.element}}class j extends H{constructor(e,t){super(e,t)}get innerHTML(){return this.element.innerHTML}set innerHTML(e){this.element.innerHTML=e}}class W extends H{constructor(e,t){super(e,t)}get name(){return this.element.name}set name(e){this.element.name=e}submit(){return this.element.submit()}}class D extends H{constructor(e,t){super(e,t)}get mappedElement(){return this.element}play(){this.element.play()}mute(){this.element.muted=!0}unmute(){this.element.muted=!1}}class X{static map(e,t){return X.mapsToRadio(e)?new z(e,t):X.mapsToCheckbox(e)?new F(e,t):X.mapsToSubmit(e)?new U(e,t):X.mapsToForm(e)?new W(e,t):X.mapsToTextarea(e)?new B(e,t):X.mapsToText(e)?new U(e,t):X.mapsToVideo(e)?new D(e,t):X.mapsToTextnode(e)?new _(e,t):(X.mapsToSimple(e)||console.log("Mapping to simple by default "+e),new j(e,t))}static mapsToRadio(e){return e instanceof HTMLInputElement&&"radio"===e.type||e instanceof g&&"input"===e.name&&e.getAttribute("type")&&"radio"===e.getAttribute("type").value}static mapsToCheckbox(e){return e instanceof HTMLInputElement&&"checkbox"===e.type||e instanceof g&&"input"===e.name&&e.getAttribute("type")&&"checkbox"===e.getAttribute("type").value}static mapsToSubmit(e){return e instanceof HTMLInputElement&&"submit"===e.type||e instanceof g&&"input"===e.name&&e.getAttribute("type")&&"submit"===e.getAttribute("type").value}static mapsToForm(e){return e instanceof HTMLFormElement||e instanceof g&&"form"===e.name}static mapsToText(e){if(e instanceof HTMLInputElement){if("text"===e.type)return!0;if("password"===e.type)return!0;if("email"===e.type)return!0;if("date"===e.type)return!0;if("time"===e.type)return!0}if(e instanceof g&&"input"===e.name){if(!e.getAttribute("type"))return!0;if("text"===e.getAttribute("type").value)return!0;if("password"===e.getAttribute("type").value)return!0;if("email"===e.getAttribute("type").value)return!0;if("date"===e.getAttribute("type").value)return!0;if("time"===e.getAttribute("type").value)return!0}return!1}static mapsToTextnode(e){return e instanceof Node&&"TEXT_NODE"===e.nodeType||e instanceof f}static mapsToVideo(e){return e instanceof HTMLVideoElement||e instanceof g&&"video"===e.name}static mapsToTextarea(e){return e instanceof HTMLTextAreaElement||e instanceof g&&"textarea"===e.name}static mapsToSimple(e){return e instanceof HTMLElement||e instanceof g}}class Q{constructor(e){this.event=e,"dragstart"==this.event.type.toLowerCase()&&this.event.dataTransfer.setData("text/plain",null)}stopPropagation(){this.event.stopPropagation()}preventDefault(){this.event.preventDefault()}getOffsetX(){return this.event.offsetX}getOffsetY(){return this.event.offsetY}getClientX(){return this.event.clientX}getClientY(){return this.event.clientY}getTarget(){return X.map(this.event.target)}getKeyCode(){return this.event.keyCode}isKeyCode(e){return this.event.keyCode===e}}new s("EventRegistry");class q{constructor(){this.listeners=new t,this.beforeListeners=new t,this.afterListeners=new t}attach(e,t,s,i){const n=s+"_"+i,r=this;e.attachEvent(t,(function(e){r.trigger(n,s,e)}))}listen(e,t,s){const i=e+"_"+s;this.initMap(this.listeners,i);this.listeners.get(i).set(t.object.constructor.name,t)}listenBefore(e,t){this.initMap(this.beforeListeners,e);this.beforeListeners.get(e).set(t.object.constructor.name,t)}listenAfter(e,t){this.initMap(this.afterListeners,e);this.afterListeners.get(e).set(t.object.constructor.name,t)}initMap(e,s){e.exists(s)||e.set(s,new t)}trigger(e,t,s){this.handleBefore(t,s),this.listeners.exists(e)&&this.listeners.get(e).forEach(((e,t,i)=>(t.call(new Q(s)),!0)),this),this.handleAfter(t,s)}handleBefore(e,t){this.handleGlobal(this.beforeListeners,e,t)}handleAfter(e,t){this.handleGlobal(this.afterListeners,e,t)}handleGlobal(e,t,s){e.exists(t)&&e.get(t).forEach(((e,t,i)=>(t.call(new Q(s)),!0)),this)}}class Y{idAttributeWithSuffix(e){if(G.contains(e)){var t=G.get(e);return G.set(e,t+1),e+"-"+t}return G.set(e,1),e}}var G=new t;class ${constructor(e,t,s){this.componentIndex=e,this.elementMap=s,this.rootElement=t}remove(){this.rootElement.remove()}get(e){return this.elementMap.get(e)}set(e,t){this.elementMap.get(e).set(t)}clearChildren(e){this.elementMap.get(e).clear()}setChild(e,t){this.elementMap.get(e).setChild(t)}addChild(e,t){this.elementMap.get(e).addChild(t)}prependChild(e,t){this.elementMap.get(e).prependChild(t)}}class J{constructor(e,s,i){this.componentIndex=i,this.uniqueIdRegistry=s,this.eventRegistry=e,this.rootElement=null,this.elementMap=new t}getElementMap(){return this.elementMap}elementCreated(e,t){var s=X.map(e,t);return this.addToElementIdMap(s),this.registerElementEvents(s),null===this.rootElement&&null!==s&&(this.rootElement=s),s}registerElementEvents(e){if(null!=e&&e instanceof H){var t=this.eventRegistry,s=this.componentIndex;e.attributes.forEach((function(i,n,r){if(null!=n&&n.value.startsWith("//event:")){var a=n.value,l=n.name;t.attach(e,l,a,s)}return!0}),this)}}addToElementIdMap(e){if(null!=e&&e instanceof H){var t=null;e.containsAttribute("id")&&(t=e.getAttributeValue("id"),e.setAttributeValue("id",this.uniqueIdRegistry.idAttributeWithSuffix(t))),null!==t&&this.elementMap.set(t,e)}}}class K{static replaceComponent(e,t){var s=p.getElementById(e);s.parentNode.replaceChild(t.rootElement.mappedElement,s)}static setComponent(e,t){var s=p.getElementById(e);s.innerHTML="",s.appendChild(t.rootElement.mappedElement,s)}static addChildComponent(e,t){p.getElementById(e).appendChild(t.rootElement.mappedElement)}static addChildElement(e,t){p.getElementById(e).appendChild(t.mappedElement)}static removeElement(e){p.removeElement(e)}static addHeaderElement(e){p.addElement("head",e.mappedElement)}static addBodyElement(e){p.addElement("body",e.mappedElement)}static prependHeaderElement(e){p.prependElement("head",e.mappedElement)}static prependBodyElement(e){p.prependElement("body",e.mappedElement)}}class Z{static custom(e){var t=new g(e);return X.map(t)}static applyStyles(e,t,s){null!==t&&e.setAttributeValue("class",t),null!==s&&e.setAttributeValue("style",s)}static a(e,t,s,i){var n=Z.custom("a");return n.addChild(e),n.setAttributeValue("href",t),Z.applyStyles(n,s,i),n}}const ee=new s("CanvasStyles"),te=new t,se=new t,ie=new e;class ne{static setStyle(e,t){if(te.contains(e))te.get(e).setChild(new _(t.getStylesSource()));else{let s=Z.custom("style");s.setAttributeValue("id",e),s.setChild(new _(t.getStylesSource())),te.set(e,s)}}static removeStyle(e){ie.contains(e)&&(ie.remove(e),K.removeElement(e)),te.contains(e)&&te.remove(e)}static disableStyle(e,t=0){ne.removeStyleOwner(e,t),ne.hasStyleOwner(e)||(te.contains(e)?ie.contains(e)&&(ie.remove(e),K.removeElement(e)):ee.error("Style does not exist: "+e))}static enableStyle(e,t=0){ne.addStyleOwner(e,t),te.contains(e)?ie.contains(e)||(ie.add(e),K.addHeaderElement(te.get(e))):ee.error("Style does not exist: "+e)}static addStyleOwner(t,s){se.contains(t)||se.set(t,new e),se.get(t).contains(s)||se.get(t).add(s)}static removeStyleOwner(e,t){se.contains(e)&&se.get(e).remove(t)}static hasStyleOwner(e){return!!se.contains(e)&&se.get(e).size()>0}}const re=new s("ComponentFactory");class ae{constructor(){this.eventRegistry=r.instance(q),this.stylesRegistry=r.instance(L),this.templateRegistry=r.instance(T),this.uniqueIdRegistry=r.instance(Y)}create(e){var t=this.templateRegistry.get(e);if(!t)throw re.error(this.templateRegistry),"No template was found with name "+e;var s=new J(this.eventRegistry,this.uniqueIdRegistry,le++);return new v(t.getTemplateSource(),s).load(),this.mountStyles(e),new $(s.componentIndex,s.rootElement,s.getElementMap())}mountStyles(e){this.stylesRegistry.contains(e)&&ne.setStyle(e,this.stylesRegistry.get(e))}}var le=0;new s("Config");class oe{static getInstance(){return he}constructor(){this.typeConfigList=new e([a.unnamed(T),a.unnamed(L),a.unnamed(Y),a.unnamed(ae),l.unnamed(q)])}getTypeConfigList(){return this.typeConfigList}}const he=new oe,ce=new s("Application");class ue{constructor(){this.workerList=new e,this.moduleLoaderList=new e,this.config=new o,this.runningWorkers=new e,this.config.addAllTypeConfig(oe.getInstance().getTypeConfigList()).addAllConfigProcessor(new e([k])).addAllInstanceProcessor(new e([h]))}addAllTypeConfig(e){this.config.addAllTypeConfig(e)}run(){this.getMatchingModuleLoader().load(),this.startWorkers()}executeMatchingModule(){this.getMatchingModuleLoader().defaultInstance.load()}startWorkers(){this.runningWorkers.size()>0||this.workerList.forEach(((e,t)=>{const s=new e;return c.inject(s,this.config),this.runningWorkers.add(s),!0}),this)}getMatchingModuleLoader(){let e=null;return this.moduleLoaderList.forEach(((t,s)=>!t.matches()||(e=t,!1)),this),e}windowDiConfig(){window.diConfig=()=>{ce.info(this.config.configEntries)}}windowTemplateRegistry(){window.templateRegistry=()=>{ce.info(u.instanceHolder(T.name,this.config).instance)}}windowStyleRegistry(){window.styleRegistry=()=>{ce.info(u.instanceHolder(L.name,this.config).instance)}}}new s("InputElementDataBinding");class de{constructor(t,s){this.model=t,this.validator=s,this.pullers=new e,this.pushers=new e}static link(e,t){return new de(e,t)}and(e){return this.to(e)}to(e){const t=()=>{i.getValue(this.model,e.name)!==e.value&&i.setValue(this.model,e.name,e.value),this.validator&&this.validator.validate&&this.validator.validate(e.value)};e.attachEvent("onchange",t),e.attachEvent("onkeyup",t),t.call();let s="__changed_"+e.name.replace(".","_");return this.model[s]||(this.model[s]=()=>{this.push()}),this.pullers.add(t),this.pushers.add((()=>{var t=i.getValue(this.model,e.name);t!==e.value&&(e.value=t),this.validator&&this.validator.validateSilent&&e.value&&this.validator.validateSilent(e.value)})),this}pull(){this.pullers.forEach(((e,t)=>(e.call(t),!0)),this)}push(){this.pushers.forEach(((e,t)=>(e.call(t),!0)),this)}}class me{static createProxyObject(e){return new Proxy(e,{set:(e,t,s)=>{let i=e[t]=s,n=e["__changed_"+t];if(n&&"function"==typeof n){n.bind(e)()}return i===s}})}}class pe extends n{constructor(e,t){this.objectFunction=e,this.filter=t}call(e){this.filter&&this.filter.call(this,e)&&this.objectFunction.call(e)}}new s("DiModuleLoader");class ge extends R{constructor(e,t,s,i,n=[]){super(t,s,i,n),this.config=e}load(e){const t=this;t.filtersPass()&&(t.defaultInstance?t.defaultInstance.load(e):t.importModule().then((()=>{t.defaultInstance.load(e)})))}importModule(){const e=this;return new Promise(((t,s)=>super.importModule().then((()=>{this.config.addAllTypeConfig(e.defaultInstance.typeConfigList),this.config.finalize().then((()=>{c.inject(e.defaultInstance,this.config).then((()=>{t()}))}))}))))}}class fe{constructor(e,t,s){this.code=e,this.objectFunction=t,this.mapperFunction=s}}const ve=new s("HttpCallBuilder");class ye{constructor(e,s){this.url=e,this.paramter=s,this.httpCallbackMap=new t,this.errorCallback=null,this.connectionTimeoutValue=4e3,this.responseTimeoutValue=4e3,this.errorMapperFunction=null,this.authorization=null}static newInstance(e,t,s){return new ye(e,t,s)}responseMapping(e,t,s){return this.httpCallbackMap.set(e,new fe(e,t,s)),this}errorMapping(e,t=null){return t&&(this.errorMapperFunction=t),this.errorCallback=e,this}authorizationHeader(e){return this.authorization="Bearer "+e,this}connectionTimeout(e){this.connectionTimeoutValue=e}responseTimeout(e){this.responseTimeoutValue=e}get(){y.get(this.url,this.connectionTimeoutValue,this.responseTimeoutValue).then((e=>{this.processResponse(e)}),(e=>{this.processError(e)}))}post(){y.post(this.url,this.paramter,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization).then((e=>{this.processResponse(e)}),(e=>{this.processError(e)}))}put(){y.put(this.url,this.paramter,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization).then((e=>{this.processResponse(e)}),(e=>{this.processError(e)}))}patch(){y.patch(this.url,this.paramter,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization).then((e=>{this.processResponse(e)}),(e=>{this.processError(e)}))}delete(){y.delete(this.url,this.connectionTimeoutValue,this.responseTimeoutValue).then((e=>{this.processResponse(e)}),(e=>{this.processError(e)}))}processError(e){ve.error(e),this.errorCallback&&(this.errorMapperFunction&&(e=this.errorMapperFunction.call(this,e)),this.errorCallback.call(e))}processResponse(e){var t=this.httpCallbackMap.get(e.status);t&&(t.mapperFunction?e.json().then((e=>{var s=t.mapperFunction;s?t.objectFunction.call(s(e)):t.objectFunction.call(e)}),(e=>{})):t.objectFunction.call())}}const we=new s("AbstractValidator");class be{constructor(t=!1,s=!0){this.validListenerList=new e,this.invalidListenerList=new e,this.currentlyValid=t,this.enabled=s}enable(){this.enabled=!0,this.isValid()?this.valid():this.invalid()}disable(){let e=this.currentlyValid;this.valid(),this.enabled=!1,this.currentlyValid=e}isValid(){return!this.enabled||this.currentlyValid}valid(){this.enabled&&(this.currentlyValid=!0,this.validListenerList?this.validListenerList.forEach(((e,t)=>(e.call(),!0)),this):we.warn("No validation listeners"))}invalid(){this.enabled&&(this.currentlyValid=!1,this.invalidListenerList?this.invalidListenerList.forEach(((e,t)=>(e.call(),!0)),this):we.warn("No invalidation listeners"))}validSilent(){this.currentlyValid=!0}invalidSilent(){this.currentlyValid=!1}withValidListener(e){return this.validListenerList.add(e),this}withInvalidListener(e){return this.invalidListenerList.add(e),this}}class Ee extends be{constructor(t=!1){super(t),this.validatorList=new e}withValidator(e){return e.withValidListener(new n(this,this.oneValid)),e.withInvalidListener(new n(this,this.oneInvalid)),this.validatorList.add(e),this}oneValid(){let e=!1;this.validatorList.forEach(((t,s)=>!!t.isValid()||(e=!0,!1)),this),e?super.invalid():super.valid()}oneInvalid(){super.invalid()}}class Le extends be{constructor(e=!1,t=!1,s="(.*)"){super(t),this.mandatory=e,this.regex=s}validate(e){e&&"string"==typeof e&&e.match(this.regex)?this.valid():e||this.mandatory?this.invalid():this.valid()}validateSilent(e){e&&"string"==typeof e&&e.match(this.regex)?this.validSilent():e||this.mandatory?this.invalidSilent():this.validSilent()}}const Me=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;class Ce extends Le{constructor(e=!1,t=!1){super(e,t,Me)}}class Te extends be{constructor(e=!1,t=!1,s=null){super(t),this.mandatory=e,this.comparedValueFunction=s}validate(e){!e&&this.mandatory?this.invalid():e===this.comparedValueFunction.call()?this.valid():this.invalid()}validateSilent(e){!e&&this.mandatory?this.invalidSilent():e===this.comparedValueFunction.call()?this.validSilent():this.invalidSilent()}}class Se extends be{constructor(e=!1,t=!1,s=null,i=null){super(t),this.mandatory=e,this.model=s,this.attributeName=i}validate(e){!e&&this.mandatory?this.invalid():e===i.getValue(this.model,this.attributeName)?this.valid():this.invalid()}validateSilent(e){!e&&this.mandatory?this.invalidSilent():e===i.getValue(this.model,this.attributeName)?this.validSilent():this.invalidSilent()}}class xe extends be{constructor(e=!1,t=!1,s=null){super(t),this.mandatory=e,this.controlValue=s}validate(e){!e&&this.mandatory?this.invalid():e===controlValue?this.valid():this.invalid()}validateSilent(e){!e&&this.mandatory?this.invalidSilent():e===controlValue?this.validSilent():this.invalidSilent()}}class ke extends be{constructor(t=!1){super(t),this.validatorList=new e}withValidator(e){return e.withValidListener(new n(this,this.oneValid)),e.withInvalidListener(new n(this,this.oneInvalid)),this.validatorList.add(e),this}oneValid(){super.valid()}oneInvalid(){let e=!1;this.validatorList.forEach(((t,s)=>!t.isValid()||(e=!0,!1)),this),e?super.valid():super.invalid()}}const Pe=/^(?=.*[A-Za-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;class Ae extends Le{constructor(e=!1,t=!1){super(e,t,Pe)}}const Ve=/^\+[0-9]{2}\s?([0-9]\s?)*$/;class Re extends Le{constructor(e=!1,t=!1){super(e,t,Ve)}}class Ie extends be{constructor(e=!1,t=!0){super(e,t)}validate(e){""===e?this.invalid():this.valid()}validateSilent(e){""===e?this.invalidSilent():this.validSilent()}}export{O as AbstractInputElement,be as AbstractValidator,Ee as AndValidatorSet,ue as Application,I as Attribute,H as BaseElement,K as CanvasRoot,ne as CanvasStyles,F as CheckboxInputElement,y as Client,$ as Component,k as ComponentConfigProcessor,ae as ComponentFactory,oe as Config,ge as DiModuleLoader,X as ElementMapper,J as ElementRegistrator,Ce as EmailValidator,Te as EqualsFunctionResultValidator,Se as EqualsPropertyValidator,xe as EqualsStringValidator,Q as Event,pe as EventFilteredObjectFunction,q as EventRegistry,W as FormElement,Z as HTML,P as History,ye as HttpCallBuilder,fe as HttpResponseHandler,de as InputElementDataBinding,V as LoaderFilter,R as ModuleLoader,ke as OrValidatorSet,Ae as PasswordValidator,Re as PhoneValidator,me as ProxyObjectFactory,z as RadioInputElement,Le as RegexValidator,Ie as RequiredValidator,j as SimpleElement,b as Styles,x as StylesLoader,L as StylesRegistry,M as Template,T as TemplateRegistry,S as TemplatesLoader,U as TextInputElement,B as TextareaInputElement,_ as TextnodeElement,Y as UniqueIdRegistry,w as Url,D as VideoElement};
