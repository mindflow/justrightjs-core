import{ContainerUrl as t,ContainerHttpClient as e,ContainerElement as s,ContainerWindow as n}from"./containerbridge_v1.js";import{List as i,Map as r,StringUtils as a,Logger as l,ArrayUtils as o,Method as u,PropertyAccessor as c,MapUtils as h}from"./coreutil_v1.js";import{InjectionPoint as d,MindiInjector as p,SingletonConfig as m,PrototypeConfig as g,InstancePostConfigTrigger as f,MindiConfig as w,ConfigAccessor as y}from"./mindi_v1.js";import{XmlElement as E,XmlCdata as v,DomTree as b}from"./xmlparser_v1.js";class M{runModule(t){}}class A{constructor(t,e,s,n,a,l){this.protocolString=t,this.hostString=e,this.portString=s,this.pathValueList=n,this.parameterValueMap=a,this.anchorString=l,this.pathValueList||(this.pathValueList=new i),this.parameterValueMap||(this.parameterValueMap=new r)}get protocol(){return this.protocolString}get host(){return this.hostString}get port(){return this.portString}get pathsList(){return this.pathValueList}get anchor(){return this.anchorString}get parameterMap(){return this.parameterValueMap}getPathPart(t){return this.pathValueList.get(t)}replacePathValue(t,e){let s=0;for(;s<this.pathValueList.size();){if(a.nonNullEquals(t,this.pathValueList.get(s)))return this.pathValueList.set(s,e),this;s++}return this}get path(){let t="/",e=!0;return this.pathValueList.forEach((s=>{e||(t+="/"),t+=s,e=!1}),this),t}getParameter(t){return this.parameterMap.get(t)}toString(){var t="";null!==this.protocol&&(t=t+this.protocol+"//"),null!==this.host&&(t+=this.host),null!==this.port&&(t=t+":"+this.port),this.pathValueList.forEach((function(e,s){return t=t+"/"+e,!0}),this);var e=!0;return this.parameterMap.forEach((function(s,n,i){e?(e=!1,t+="?"):t+="&",t=t+encodeURI(s)+"="+encodeURI(n)}),this),null!==this.anchor&&(t=t+"#"+this.anchor),t}}class T{static parse(t){let e={string:t};if(null===t)return null;const s=T.determineProtocol(e),n=T.determineHostAndPort(e),i=T.extractHost(n),r=T.extractPort(n),a=T.determinePath(e),l=T.determineParameters(e),o=T.determineBookmark(e);return new A(s,i,r,a,l,o)}static determineProtocol(t){let e=t.string;if(!e)return null;let s=e;if(-1===e.indexOf("//"))return null;let n=e.split("//");return-1!==n[0].indexOf("/")?null:(s=n[0],1==n.length?t.string=null:t.string=e.replace(n[0]+"//",""),s)}static determineHostAndPort(t){let e=t.string;if(!e)return null;let s=e,n=null;return-1!==s.indexOf("/")&&(s=s.split("/")[0],n=e.replace(s+"/","")),t.string=n,s}static extractHost(t){return t?-1===t.indexOf(":")?t:t.split(":")[0]:null}static extractPort(t){return t?-1===t.indexOf(":")?null:t.split(":")[1]:null}static determinePath(t){let e=t.string;if(!e)return new i;let s=e;if(-1!==s.indexOf("?")){let e=s.split("?");e.length>1&&(t.string=s.substring(s.indexOf("?"))),s=e[0]}else if(-1!==s.indexOf("#")){let e=s.split("#");e.length>1&&(t.string=s.substring(s.indexOf("#"))),s=e[0]}else t.string=null;s.startsWith("/")&&(s=e.substring(1));const n=new i(s.split("/")),r=new i;return n.forEach((t=>(r.add(decodeURI(t)),!0)),this),r}static determineParameters(t){const e=t.string;if(!e)return new r;let s=e;if(-1===s.indexOf("?"))return new r;s=s.substring(s.indexOf("?")+1),-1!==s.indexOf("#")?(t.string=s.substring(s.indexOf("#")),s=s.substring(0,s.indexOf("#"))):t.string=null;const n=new i(s.split("&")),a=new r;return n.forEach((t=>{let e=t.split("=");return e.length>=2&&a.set(decodeURI(e[0]),decodeURI(e[1])),!0}),this),a}static determineBookmark(t){let e=t.string;if(!e)return t.string=null,null;let s=e;return-1!==e.indexOf("#")&&(s=e.substring(e.indexOf("#")+1),t.string=null),s}}class S{static replaceUrl(e,s,n){t.replaceUrl(e.toString(),s,n)}static pushUrl(e,s,n){t.pushUrl(e.toString(),s,n)}static currentUrl(){return T.parse(t.currentUrl())}}class x{constructor(){this.protocol=null,this.host=null,this.port=null,this.pathsList=new i,this.parametersMap=new r,this.anchor=null}static builder(){return new x}withUrl(t){return this.withAllOfUrl(T.parse(t)),this}withRootOfUrl(t){return this.protocol=t.protocol,this.port=t.port,this.host=t.host,this}withPathOfUrl(t){return this.withRootOfUrl(t),this.pathsList=t.pathsList,this}withAllOfUrl(t){return this.withPathOfUrl(t),this.parametersMap=t.parameterMap,this.bookmark=t.bookmark,this}withProtocol(t){return this.protocol=T.determinePath({string:t}),this}withHost(t){return this.host=T.determinePath({string:t}),this}withPath(t){return this.pathsList=T.determinePath({string:t}),this}withParameters(t){return this.parametersMap=T.determinePath({string:t}),this}withAnchor(t){return this.anchor=T.determineBookmark({string:t}),this}build(){return new A(this.protocol,this.host,this.port,this.pathsList,this.parametersMap,this.anchor)}}let L=null;class C{constructor(){}static instance(){return L||(L=new C),L}go(e){t.go(e.toString())}back(){t.back()}loadPath(t){const e=S.currentUrl(),s=x.builder().withRootOfUrl(e).withPath(t).build();return S.pushUrl(s),s}loadAnchor(t){const e=S.currentUrl(),s=x.builder().withRootOfUrl(e).withAnchor(t).build();return S.pushUrl(s),s}}class V{constructor(){this.root=!1,this.trail=null,this.property=null,this.waypoint=null,this.destination=null,this.next=null}}let P=null;class N{constructor(){this.moduleRunner=null}static instance(){return P||(P=new N),P}set(t){this.moduleRunner=t}async load(t){const e=C.instance().loadAnchor(t.trail);return await this.moduleRunner.runModule(e)}}class R{static get(t,s=4e3,n=4e3,i=null){var r={headers:R.getHeader(i),method:"GET",mode:"cors",redirect:"follow"};return e.fetch(t.toString(),r,s,n)}static post(t,s,n=4e3,i=4e3,r=null){let a=R.getHeader(r);var l={body:JSON.stringify(s),headers:a,method:"POST",mode:"cors",redirect:"follow"};return e.fetch(t.toString(),l,n,i)}static put(t,s,n=4e3,i=4e3,r=null){let a=R.getHeader(r);var l={body:JSON.stringify(s),method:"PUT",mode:"cors",redirect:"follow",headers:a};return e.fetch(t.toString(),l,n,i)}static patch(t,s,n=4e3,i=4e3,r=null){let a=R.getHeader(r),l={body:JSON.stringify(s),method:"PATCH",mode:"cors",redirect:"follow",headers:a};return e.fetch(t.toString(),l,n,i)}static delete(t,s,n=4e3,i=4e3,r=null){const a=R.getHeader(r);if(s){const r={body:JSON.stringify(s),method:"DELETE",mode:"cors",redirect:"follow",headers:a};return e.fetch(t.toString(),r,n,i)}{const s={method:"DELETE",mode:"cors",redirect:"follow",headers:a};return e.fetch(t.toString(),s,n,i)}}static getHeader(t=null){let e={"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"};return t&&(e={"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json",Authorization:t}),e}}class k{constructor(t){this.stylesSource=t}getStylesSource(){return this.stylesSource}}const O=new l("StylesRegistry");class U{constructor(){this.stylesMap=new Map,this.stylesUrlMap=new Map,this.stylesQueueSize=0,this.callback=null}set(t,e,s){null!=s&&this.stylesUrlMap.set(t,s),this.stylesMap.set(t,e)}get(t){return this.stylesMap.get(t)}contains(t){return!!this.stylesMap.get(t)}done(t){this.callback=t,this.doCallback(this)}doCallback(t){if(null!==tmo.callback&&void 0!==t.callback&&t.stylesQueueSize===t.stylesMap.entries.length){var e=t.callback;t.callback=null,e.call()}}async load(t,e){this.stylesQueueSize++;const s=await R.get(e);if(!s.ok)throw"Unable to load styles for "+t+" at "+e;const n=await s.text();return this.set(t,new k(n),e),this.doCallback(this),null}async getStylesLoadedPromise(t){if(!t||0==t.size)return null;let e=[];const s=this;return t.forEach(((t,n)=>{if(s.contains(n))return!0;try{e.push(s.privateLoad(n,T.parse(t)))}catch(t){throw t}})),await Promise.all(e)}async privateLoad(t,e){O.info("Loading styles "+t+" at "+e.toString());const s=await R.get(e);if(!s.ok)throw"Unable to load styles for "+t+" at "+e;const n=await s.text(),i=new k(n);return this.set(t,i,e),i}}class I{constructor(t){this.templateSource=t}getTemplateSource(){return this.templateSource}}const H=new l("TemplateRegistry");class F{constructor(){this.templateMap=new Map,this.templateUrlMap=new Map,this.templateQueueSize=0,this.callback=null,this.languagePrefix=null}setLanguagePrefix(t){this.languagePrefix=t}set(t,e,s){null!=s&&this.templateUrlMap.set(t,s),this.templateMap.set(t,e)}get(t){return this.templateMap.get(t)}contains(t){return!!this.templateMap.get(t)}done(t){this.callback=t,this.doCallback(this)}doCallback(t){if(null!==tmo.callback&&void 0!==t.callback&&t.templateQueueSize===t.templateMap.size()){var e=t.callback;t.callback=null,e.call()}}async load(t,e){null!==this.languagePrefix&&e.pathsList.setLast(this.languagePrefix+"."+e.pathsList.getLast()),this.templateQueueSize++;const s=await R.get(e);if(!s.ok)throw"Unable to load template for "+t+" at "+e;const n=await s.text();this.set(t,new I(n),e),this.doCallback(this)}async getTemplatesLoadedPromise(t){if(!t||0==t.length)return null;let e=[];const s=this;return t.forEach(((t,n)=>{if(!s.contains(n))try{e.push(s.privateLoad(n,T.parse(t)))}catch(t){throw t}})),await Promise.all(e)}async privateLoad(t,e){null!==this.languagePrefix&&e.pathsList.setLast(this.languagePrefix+"."+e.pathsList.getLast()),H.info("Loading template "+t+" at "+e.toString());const s=await R.get(e);if(!s.ok)throw"Unable to load template for "+t+" at "+e;const n=await s.text(),i=new I(n);return this.set(t,i,e),i}}new l("TemplatePostConfig");class _{constructor(t){this.templateRegistry=t}load(t){let e=new Map;return t.forEach(((t,s)=>{t.classReference.TEMPLATE_URL&&t.classReference.COMPONENT_NAME&&e.set(t.classReference.COMPONENT_NAME,t.classReference.TEMPLATE_URL)})),this.templateRegistry.getTemplatesLoadedPromise(e)}}new l("StylesLoader");class B{constructor(t){this.stylesRegistry=t}load(t){const e=new Map;return t.forEach(((t,s)=>(t.classReference.STYLES_URL&&t.classReference.COMPONENT_NAME&&e.set(t.classReference.COMPONENT_NAME,t.classReference.STYLES_URL),!0)),this),this.stylesRegistry.getStylesLoadedPromise(e)}}new l("ComponentConfigProcessor");class z{constructor(){this.templateRegistry=d.instance(F),this.stylesRegistry=d.instance(U)}postConfig(){this.templatesLoader=new _(this.templateRegistry),this.stylesLoader=new B(this.stylesRegistry)}processConfig(t,e){return Promise.all([this.templatesLoader.load(e),this.stylesLoader.load(e)])}}let D=new r;class j{static configure(t,e){D.set(t,e)}static execute(t,e){return D.get(t).call(null,e)}}class q{constructor(t){this.attribute=t}get value(){return this.attribute.value}get name(){return this.attribute.name}get namespace(){return this.attribute.name}}class W{constructor(){this.element=null}get mappedElement(){return this.element}set mappedElement(t){this.element=t}}const X=new l("ElementUtils");class Y{static createContainerElement(t,e){return t instanceof E?Y.createFromXmlElement(t,e):"string"==typeof t?s.createElement(t):s.isUIElement(t)?t:(X.error("Unrecognized value for Element"),X.error(t),null)}static createFromXmlElement(t,e){let n=null;return n=t.namespace?s.createElementNS(t.namespaceUri,t.fullName):s.createElement(t.name),e&&null!==e.mappedElement&&s.appendChild(e.mappedElement,n),t.attributes.forEach(((t,e)=>(s.setAttribute(n,t,e.value),!0))),n}}const Q=new l("BaseElement");class $ extends W{constructor(t,e){super(),this.attributeMap=null,this.eventsAttached=new i,super.mappedElement=Y.createContainerElement(t,e)}loadAttributes(){if(null!==super.mappedElement.attributes&&void 0!==super.mappedElement.attributes){if(null===this.attributeMap||void 0===this.attributeMap){this.attributeMap=new r;for(var t=0;t<super.mappedElement.attributes.length;t++)this.attributeMap.set(super.mappedElement.attributes[t].name,new q(super.mappedElement.attributes[t]))}}else this.attributeMap=new r}listenTo(t,e,n){return s.addEventListener(super.mappedElement,t,(t=>{e.call(j.execute("wrapEvent",t))}),n),this}get fullName(){return super.mappedElement.tagName}get top(){return super.mappedElement.getBoundingClientRect().top}get bottom(){return super.mappedElement.getBoundingClientRect().bottom}get left(){return super.mappedElement.getBoundingClientRect().left}get right(){return super.mappedElement.getBoundingClientRect().right}get width(){return super.mappedElement.offsetWidth}get height(){return super.mappedElement.offsetHeight}get attributes(){return this.loadAttributes(),this.attributeMap}setAttributeValue(t,e){s.setAttribute(super.mappedElement,t,e)}getAttributeValue(t){return s.getAttribute(super.mappedElement,t)}containsAttribute(t){return super.mappedElement.hasAttribute(t)}removeAttribute(t){super.mappedElement.removeAttribute(t)}setStyle(t,e){super.mappedElement.style[t]=e}getStyle(t){return super.mappedElement.style[t]}removeStyle(t){super.mappedElement.style[t]=null}set(t){if(super.mappedElement.parentNode){if(!t.mappedElement)return t&&t.rootElement?(super.mappedElement.parentNode.replaceChild(t.rootElement.mappedElement,super.mappedElement),void(super.mappedElement=t.rootElement.mappedElement)):void("string"!=typeof t?t instanceof Text||t instanceof Element?super.mappedElement.parentNode.replaceChild(t,super.mappedElement):(Q.warn("No valid input to set the element"),Q.warn(t)):super.mappedElement.parentNode.replaceChild(s.createTextNode(t),super.mappedElement));super.mappedElement.parentNode.replaceChild(t.mappedElement,super.mappedElement)}else console.error("The element has no parent, can not swap it for value")}isMounted(){return!!super.mappedElement.parentNode}remove(){super.mappedElement.parentNode&&super.mappedElement.parentNode.removeChild(super.mappedElement)}clear(){for(;super.mappedElement.firstChild;)super.mappedElement.removeChild(super.mappedElement.firstChild)}setChild(t){this.clear(),this.addChild(t)}addChild(t){void 0===t.mappedElement||null===t.mappedElement?t&&t.rootElement?super.mappedElement.appendChild(t.rootElement.mappedElement):"string"!=typeof t?t instanceof Text||t instanceof Element?super.mappedElement.appendChild(t):(Q.warn("No valid input to add the element"),Q.warn(t)):super.mappedElement.appendChild(s.createTextNode(t)):super.mappedElement.appendChild(t.mappedElement)}prependChild(t){null===super.mappedElement.firstChild&&this.addChild(t),void 0===t.mappedElement||null===t.mappedElement?t&&t.rootElement?super.mappedElement.insertBefore(t.rootElement.mappedElement,super.mappedElement.firstChild):"string"!=typeof t?t instanceof Text||t instanceof Element?super.mappedElement.insertBefore(t,super.mappedElement.firstChild):(Q.warn("No valid input to prepend the element"),Q.warn(t)):super.mappedElement.insertBefore(s.createTextNode(t),super.mappedElement.firstChild):super.mappedElement.insertBefore(t.mappedElement,super.mappedElement.firstChild)}}class J extends ${constructor(t,e){super(t,e)}get innerHTML(){return this.element.innerHTML}set innerHTML(t){this.element.innerHTML=t}}class G{constructor(t){this.event=t,"dragstart"==this.event.type.toLowerCase()&&this.event.dataTransfer.setData("text/plain",null)}stopPropagation(){this.event.stopPropagation()}preventDefault(){this.event.preventDefault()}get offsetX(){return this.event.offsetX}get offsetY(){return this.event.offsetY}get clientX(){return this.event.clientX}get clientY(){return this.event.clientY}get target(){if(this.event&&this.event.target)return j.execute("mapElement",this.event.target)}get relatedTarget(){return this.event&&this.event.relatedTarget?j.execute("mapElement",this.event.relatedTarget):null}getRelatedTargetAttribute(t){return this.event.relatedTarget?j.execute("mapElement",this.event.relatedTarget).getAttributeValue(t):null}get targetValue(){return this.target?this.target.value:null}get keyCode(){return this.event.keyCode}isKeyCode(t){return this.event.keyCode===t}}const K=new l("LoaderInterceptor");class Z{process(){return K.info("Unimplemented Loader Interceptor breaks by default"),!1}}const tt=new l("ModuleLoader");class et{constructor(t,e,s=[]){this.modulePath=t,this.trailMap=e,this.loaderInterceptors=s}matches(t){return!this.trailMap||(t?t.anchor?a.startsWith(t.anchor+"/",this.trailMap.trail+"/"):!!this.trailMap.root:(tt.error("Url is null"),!1))}async load(){try{const t=await this.importModule();return await this.interceptorsPass(),t}catch(t){return tt.warn("Filter rejected "+t),null}}interceptorsPass(){const t=this.loaderInterceptors;if(t&&t.length>0){let e=t[0].process();for(let s=1;s<t.length;s++)e=e.then(t[s]);return e}return Promise.resolve()}async importModule(){try{return new((await import(this.modulePath)).default)}catch(t){throw t}}}class st{constructor(){this.url=null,this.trailMap=null}async load(){throw"Module class must implement load()"}}const nt=new l("DiModuleLoader");class it extends et{constructor(t,e,s,n=[]){super(t,e,n),this.config=s}async load(){try{const t=await this.importModule();return await this.interceptorsPass(),await p.inject(t,this.config)}catch(t){throw nt.warn("Module loader failed "+t),t}}async importModule(){try{const t=await super.importModule();this.config.addAllTypeConfig(t.typeConfigArray),await this.config.finalize();const e=this.config;return await o.promiseChain(this.loaderInterceptors,(t=>p.inject(t,e))),t}catch(t){throw t}}}new l("AbstractInputElement");class rt extends ${constructor(t,e){super(t,e)}get name(){return this.element.name}set name(t){this.element.name=t}get value(){return this.backingValue}set value(t){this.element.value=t,this.element.dispatchEvent(new InputEvent("change"))}get backingValue(){return this.element.value}focus(){this.element.focus()}selectAll(){this.element.select()}enable(){this.element.disabled=!1}disable(){this.element.disabled=!0}}class at extends rt{constructor(t,e){super(t,e)}set checked(t){this.element.checked=t}isChecked(){return this.element.checked}get value(){return this.isChecked()}set value(t){this.element.checked=!0===t||"true"===t}}class lt extends rt{constructor(t,e){super(t,e)}set checked(t){this.element.checked=t}isChecked(){return this.element.checked}get value(){return this.isChecked()}set value(t){this.element.checked=!0===t||"true"===t}}class ot extends rt{constructor(t,e){super(t,e)}}class ut extends rt{constructor(t,e){super(t,e)}get innerHTML(){return this.element.innerHTML}set innerHTML(t){this.element.innerHTML=t}addChild(t){super.addChild(t),this.value=this.innerHTML}prependChild(t){super.prependChild(t),this.value=this.innerHTML}}class ct{constructor(t,e){t instanceof v&&(this.element=this.createFromXmlCdata(t,e)),"string"==typeof t&&(this.element=s.createTextNode(t))}createFromXmlCdata(t,e){let n=document.createTextNode(t.value);return null!==e&&null!==e.mappedElement&&s.appendChild(e.mappedElement,n),n}set value(t){this.element=t}get value(){return this.element}get mappedElement(){return this.element}}class ht extends ${constructor(t,e){super(t,e)}get name(){return this.element.name}set name(t){this.element.name=t}submit(){return this.element.submit()}}class dt extends ${constructor(t,e){super(t,e)}get mappedElement(){return this.element}play(){this.element.play()}mute(){this.element.muted=!0}unmute(){this.element.muted=!1}}class pt{static map(t,e){return pt.mapsToRadio(t)?new at(t,e):pt.mapsToCheckbox(t)?new lt(t,e):pt.mapsToSubmit(t)?new ot(t,e):pt.mapsToForm(t)?new ht(t,e):pt.mapsToTextarea(t)?new ut(t,e):pt.mapsToText(t)?new ot(t,e):pt.mapsToVideo(t)?new dt(t,e):pt.mapsToTextnode(t)?new ct(t,e):(pt.mapsToSimple(t)||console.log("Mapping to simple by default "+t),new J(t,e))}static mapsToRadio(t){return t instanceof HTMLInputElement&&"radio"===t.type||t instanceof E&&"input"===t.name&&t.getAttribute("type")&&"radio"===t.getAttribute("type").value}static mapsToCheckbox(t){return t instanceof HTMLInputElement&&"checkbox"===t.type||t instanceof E&&"input"===t.name&&t.getAttribute("type")&&"checkbox"===t.getAttribute("type").value}static mapsToSubmit(t){return t instanceof HTMLInputElement&&"submit"===t.type||t instanceof E&&"input"===t.name&&t.getAttribute("type")&&"submit"===t.getAttribute("type").value}static mapsToForm(t){return t instanceof HTMLFormElement||t instanceof E&&"form"===t.name}static mapsToText(t){if(t instanceof HTMLInputElement){if("text"===t.type)return!0;if("number"===t.type)return!0;if("password"===t.type)return!0;if("email"===t.type)return!0;if("date"===t.type)return!0;if("time"===t.type)return!0}if(t instanceof E&&"input"===t.name){if(!t.getAttribute("type"))return!0;if("text"===t.getAttribute("type").value)return!0;if("number"===t.getAttribute("type").value)return!0;if("password"===t.getAttribute("type").value)return!0;if("email"===t.getAttribute("type").value)return!0;if("date"===t.getAttribute("type").value)return!0;if("time"===t.getAttribute("type").value)return!0}return!1}static mapsToTextnode(t){return t instanceof Node&&"TEXT_NODE"===t.nodeType||t instanceof v}static mapsToVideo(t){return t instanceof HTMLVideoElement||t instanceof E&&"video"===t.name}static mapsToTextarea(t){return t instanceof HTMLTextAreaElement||t instanceof E&&"textarea"===t.name}static mapsToSimple(t){return t instanceof HTMLElement||t instanceof E}}class mt{constructor(){this.objectMap=new Map,this.listeners=new Map}react(t){const e="__ANY__";this.listeners.has(e)||this.listeners.set(e,new Array),this.listeners.get(e).push(t)}reactTo(t,e){this.listeners.has(t)||this.listeners.set(t,new Array),this.listeners.get(t).push(e)}async update(t,e="__DEFAULT__"){if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=this.createProxy(t[s],e,this);return t=this.createProxy(t,e,this),this.objectMap.set(e,t),this.signalStateChange(t,e),t}signalStateChange(t,e){if(this.listeners.has(e))for(let s of this.listeners.get(e))s.call([t]);const s="__ANY__";if(e!=s&&this.listeners.has(s))for(let e of this.listeners.get(s))e.call([t])}createProxy(t,e,s){return new Proxy(t,{set:(t,n,i)=>{if(t[n]===i)return!0;const r=t[n]=i;return s.signalStateChange(t,e),r===i}})}}class gt{idAttributeWithSuffix(t){if(ft.contains(t)){var e=ft.get(t);return ft.set(t,e+1),t+"-"+e}return ft.set(t,1),t}}var ft=new r;class wt{constructor(t,e,s){this.componentIndex=t,this.elementMap=s,this.rootElement=e}remove(){this.rootElement.remove()}get(t){return this.elementMap.get(t)}set(t,e){return this.elementMap.get(t).set(e),this.elementMap.get(t)}clearChildren(t){return this.elementMap.get(t).clear(),this.elementMap.get(t)}setChild(t,e){return this.elementMap.get(t).setChild(e),this.elementMap.get(t)}addChild(t,e){return this.elementMap.get(t).addChild(e),this.elementMap.get(t)}prependChild(t,e){return this.elementMap.get(t).prependChild(e),this.elementMap.get(t)}}class yt{constructor(t,e){this.componentIndex=e,this.uniqueIdRegistry=t,this.rootElement=null,this.elementMap=new r}getElementMap(){return this.elementMap}elementCreated(t,e){const s=pt.map(t,e);return this.addToElementIdMap(s),null===this.rootElement&&null!==s&&(this.rootElement=s),s}addToElementIdMap(t){if(null!=t&&t instanceof $){var e=null;t.containsAttribute("id")&&(e=t.getAttributeValue("id"),t.setAttributeValue("id",this.uniqueIdRegistry.idAttributeWithSuffix(e))),null!==e&&this.elementMap.set(e,t)}}}class Et{static shouldSwallowNextFocusEscape=!1;static mouseDownElement=null;static focusEscapeEventRequested=!1;static replaceComponent(t,e){const n=s.getElementById(t);n.parentNode.replaceChild(e.rootElement.mappedElement,n)}static setComponent(t,e){const n=s.getElementById(t);n.innerHTML="",n.appendChild(e.rootElement.mappedElement,n)}static addChildComponent(t,e){s.getElementById(t).appendChild(e.rootElement.mappedElement)}static addChildElement(t,e){s.getElementById(t).appendChild(e.mappedElement)}static removeElement(t){s.removeElement(t)}static addHeaderElement(t){s.appendRootMetaChild(t.mappedElement)}static addBodyElement(t){s.appendRootUiChild(t.mappedElement)}static prependHeaderElement(t){s.prependElement("head",t.mappedElement)}static prependBodyElement(t){s.prependElement("body",t.mappedElement)}static listenToFocusEscape(t,e){if(!Et.focusEscapeEventRequested){const t=new u(null,(t=>{Et.mouseDownElement=t.target}));n.addEventListener("mousedown",t,G),Et.focusEscapeEventRequested=!0}const i=new u(null,(n=>{Et.mouseDownElement||(Et.mouseDownElement=n.target),s.contains(e.element,Et.mouseDownElement.element)||Et.shouldSwallowNextFocusEscape||t.call(n)}));n.addEventListener("click",i,G)}static swallowFocusEscape(t){Et.shouldSwallowNextFocusEscape=!0,setTimeout((()=>{Et.shouldSwallowNextFocusEscape=!1}),t)}}class vt{static custom(t){var e=new E(t);return pt.map(e)}static applyStyles(t,e,s){e&&t.setAttributeValue("class",e),s&&t.setAttributeValue("style",s)}static a(t,e,s,n){var i=vt.custom("a");return i.addChild(t),i.setAttributeValue("href",e),vt.applyStyles(i,s,n),i}static i(t,e,s){var n=vt.custom("i");return n.addChild(t),vt.applyStyles(n,e,s),n}}const bt=new l("CanvasStyles"),Mt=new r,At=new r,Tt=new i;class St{static setStyle(t,e){if(Mt.contains(t))Mt.get(t).setChild(new ct(e.getStylesSource()));else{let s=vt.custom("style");s.setAttributeValue("id",t),s.setChild(new ct(e.getStylesSource())),Mt.set(t,s)}}static removeStyle(t){Tt.contains(t)&&(Tt.remove(t),Et.removeElement(t)),Mt.contains(t)&&Mt.remove(t)}static disableStyle(t,e=0){St.removeStyleOwner(t,e),St.hasStyleOwner(t)||(Mt.contains(t)?Tt.contains(t)&&(Tt.remove(t),Et.removeElement(t)):bt.error("Style does not exist: "+t))}static enableStyle(t,e=0){St.addStyleOwner(t,e),Mt.contains(t)?Tt.contains(t)||(Tt.add(t),Et.addHeaderElement(Mt.get(t))):bt.error("Style does not exist: "+t)}static addStyleOwner(t,e){At.contains(t)||At.set(t,new i),At.get(t).contains(e)||At.get(t).add(e)}static removeStyleOwner(t,e){At.contains(t)&&At.get(t).remove(e)}static hasStyleOwner(t){return!!At.contains(t)&&At.get(t).size()>0}}const xt=new l("ComponentFactory");class Lt{constructor(){this.stylesRegistry=d.instance(U),this.templateRegistry=d.instance(F),this.uniqueIdRegistry=d.instance(gt)}create(t){var e=this.templateRegistry.get(t);if(!e)throw xt.error(this.templateRegistry),console.trace(),"No template was found with name "+t;var s=new yt(this.uniqueIdRegistry,Ct++);return new b(e.getTemplateSource(),s).load(),this.mountStyles(t),new wt(s.componentIndex,s.rootElement,s.getElementMap())}mountStyles(t){this.stylesRegistry.contains(t)&&St.setStyle(t,this.stylesRegistry.get(t))}}var Ct=0;class Vt{static proceedAlongAnchor(t,e,s){const n=Vt.triggerFunctionsAlongAnchor(t,e,s);if(!n||0===n.size())return;const i=x.builder().withAllOfUrl(S.currentUrl()),r=i.withAnchor(null).build();S.replaceUrl(r,r.toString(),null),n.forEach((t=>{const e=i.withAnchor(t).build();return S.pushUrl(e,e.toString(),t),!0}),this)}static proceedToDestinationFunction(t,e,s){const n=S.currentUrl(),i=Vt.getNodeTrailByFunction(s,t);if(0===i.length)return Promise.resolve();const r=t.call(e),l=Vt.concatinateSequenceAsAnchor(i);if(!a.nonNullEquals(n.anchor,l)){const t=x.builder().withAllOfUrl(n).withAnchor(l).build();S.pushUrl(t,t.toString(),null)}return r}static jumpToDestinationFunction(t,e,s){const n=S.currentUrl(),i=Vt.getNodeTrailByFunction(s,t);if(0===i.length)return Promise.resolve();const r=t.call(e),l=Vt.concatinateSequenceAsAnchor(i);if(!a.nonNullEquals(n.anchor,l)){const t=x.builder().withAllOfUrl(n).withAnchor(l).build();S.replaceUrl(t,t.toString(),null)}return r}static triggerFunctionsAlongAnchor(t,e,s,n=new Array){const i=n?n.join(""):"";return s.property&&(e=e[s.property]),a.startsWith(t.anchor,Vt.toStartsWith(s.trail))&&(n=o.add(n,s.trail),s.waypoint&&s.waypoint.call(e)),a.nonNullEquals(t.anchor,i+s.trail)&&(n=o.add(n,s.trail),s.destination&&s.destination.call(e)),s.next&&s.next.forEach((s=>{n=Vt.triggerFunctionsAlongAnchor(t,e,s,n)})),n}static concatinateSequenceAsAnchor(t){return t.map((t=>t.trail)).join("")}static getNodeTrailByFunction(t,e,s=new Array,n=!0){return e===t.destination&&(s=o.add(s,t)),e!==t.destination&&0===s.length&&t.next&&t.next.forEach((t=>{0===s.length&&(s=Vt.getNodeTrailByFunction(t,e,s,!1))})),s.length>0&&(s=o.add(s,t)),n&&s.length>0?s.reverse():s}static toStartsWith(t){return null==t||a.nonNullEquals(t,"/")?"/":t+"/"}}const Pt=new l("Application");class Nt extends M{constructor(t,e=new w,s=new Array){super(),this.moduleLoaderArray=t,this.config=e,this.workerArray=s,this.runningWorkers=new Array,this.activeModule=null,j.configure("wrapEvent",(t=>new G(t))),j.configure("mapElement",(t=>pt.map(t))),this.defaultConfig=[m.unnamed(F),m.unnamed(U),m.unnamed(gt),m.unnamed(Lt),g.unnamed(mt)],this.defaultConfigProcessors=[z],this.defaultInstanceProcessors=[f]}async run(){Pt.info("Running Application"),this.config.addAllTypeConfig(this.defaultConfig).addAllConfigProcessor(this.defaultConfigProcessors).addAllInstanceProcessor(this.defaultInstanceProcessors),N.instance().set(this),t.addUserNavigateListener(new u(this,this.update),G);const e=await this.runModule(S.currentUrl());return this.startWorkers(),e}update(t){const e=S.currentUrl();this.activeModule&&a.startsWith(e.anchor,this.activeModule.trailMap.trail)?Vt.triggerFunctionsAlongAnchor(e,this.activeModule,this.activeModule.trailMap):this.runModule(e)}async runModule(t){try{const e=this.getMatchingModuleLoader(t);return this.activeModule=await e.load(),this.activeModule.url=t,this.activeModule.trailMap=e.trailMap,this.activeModule.load(),this.activeModule}catch(t){return Pt.error(t),null}}startWorkers(){if(this.runningWorkers.length>0)return;const t=this.config,e=this.runningWorkers;this.workerArray.forEach((s=>{const n=new s;p.inject(n,t),o.add(e,n)}))}getMatchingModuleLoader(t){let e=null;return this.moduleLoaderArray.forEach((s=>{!e&&s.matches(t)&&(e=s)})),e}windowDiConfig(){window.diConfig=()=>{Pt.info(this.config.configEntries)}}windowTemplateRegistry(){window.templateRegistry=()=>{const t=y.typeConfigByName(F.name,this.config);Pt.info(t.instanceHolder().instance)}}windowStyleRegistry(){window.styleRegistry=()=>{const t=y.typeConfigByName(U.name,this.config);Pt.info(t.instanceHolder().instance)}}}new l("InputElementDataBinding");class Rt{constructor(t,e){this.model=t,this.validator=e,this.pullers=new i,this.pushers=new i}static link(t,e){return new Rt(t,e)}and(t){return this.to(t)}to(t){const e=()=>{c.getValue(this.model,t.name)!==t.value&&c.setValue(this.model,t.name,t.value),this.validator&&this.validator.validate&&this.validator.validate(t.value)};t.listenTo("change",new u(this,e)),t.listenTo("keyup",new u(this,e)),e.call();let s="__changed_"+t.name.replace(".","_");return this.model[s]||(this.model[s]=()=>{this.push()}),this.pullers.add(e),this.pushers.add((()=>{var e=c.getValue(this.model,t.name);e!==t.value&&(t.value=e),this.validator&&this.validator.validateSilent&&t.value&&this.validator.validateSilent(t.value)})),this}pull(){this.pullers.forEach(((t,e)=>(t.call(e),!0)),this)}push(){this.pushers.forEach(((t,e)=>(t.call(e),!0)),this)}}class kt{static createProxyObject(t){return new Proxy(t,{set:(t,e,s)=>{let n=t[e]=s,i=t["__changed_"+e];if(i&&"function"==typeof i){i.bind(t)()}return n===s}})}}class Ot extends u{constructor(t,e){this.method=t,this.filter=e}call(t){this.filter&&this.filter.call(this,t)&&this.method.call(t)}}const Ut=new l("EventManager");class It{constructor(){this.listenerMap=new r}listenTo(t,e){return this.listenerMap.contains(t)||this.listenerMap.set(t,new i),this.listenerMap.get(t).add(e),this}async trigger(t,e){if(!t)return void Ut.error("Event type is undefined");if(!this.listenerMap.contains(t))return;let s=[];return this.listenerMap.get(t).forEach(((t,n)=>(s.push(t.call(e)),!0))),1===s.length?s[0]:Promise.all(s)}}class Ht{static from(t){return new Ht(t)}constructor(t){this.baseElement=t}clear(){return this.baseElement.setAttributeValue("class",""),this}toggle(t){let e=this.baseElement.getAttributeValue("class"),s=a.toArray(e," "),n=new i(s);return n.contains(t)?n.remove(t):n.add(t),this.baseElement.setAttributeValue("class",o.toString(n.getArray()," ")),this}enable(t){let e=this.baseElement.getAttributeValue("class"),s=a.toArray(e," "),n=new i(s);return n.contains(t)||n.add(t),this.baseElement.setAttributeValue("class",o.toString(n.getArray()," ")),this}disable(t){let e=this.baseElement.getAttributeValue("class"),s=a.toArray(e," "),n=new i(s);return n.contains(t)&&n.remove(t),this.baseElement.setAttributeValue("class",o.toString(n.getArray()," ")),this}replace(t,e){let s=this.baseElement.getAttributeValue("class"),n=a.toArray(s," "),r=new i(n),l=[];return a.isBlank(t)||r.forEach((e=>(e.startsWith(t)&&l.push(e),!0)),this),l.forEach((t=>{r.remove(t)})),r.add(e),this.baseElement.setAttributeValue("class",o.toString(r.getArray()," ")),this}}class Ft{static from(t){return new Ft(t)}constructor(t){this.baseElement=t}clear(){return this.baseElement.setAttributeValue("style",""),this}remove(t){const e=this.srylesAsMap(this.baseElement.getAttributeValue("style"));return e.contains(t)&&e.remove(t),this.baseElement.setAttributeValue("style",h.toString(e,":",";")),this}set(t,e){const s=this.srylesAsMap(this.baseElement.getAttributeValue("style"));return s.set(t,e),this.baseElement.setAttributeValue("style",h.toString(s,":",";")),this}is(t,e){const s=this.srylesAsMap(this.baseElement.getAttributeValue("style"));return a.nonNullEquals(s.get(t),e)}exists(t){return this.srylesAsMap(this.baseElement.getAttributeValue("style")).contains(t)}srylesAsMap(t){if(!t||-1===t.indexOf(":"))return new r;const e=new r;return new i(a.toArray(t,";")).forEach(((t,s)=>{if(!t||-1===t.indexOf(":"))return;const n=t.split(":")[0].trim(),i=t.split(":")[1].trim();return e.set(n,i),!0}),this),e}}new l("HttpCallBuilder");class _t{constructor(t){this.url=t,this.authorization=null,this.successMappingMap=new r,this.failMappingMap=new r,this.errorMappingFunction=t=>t,this.connectionTimeoutValue=4e3,this.responseTimeoutValue=4e3}static newInstance(t){return new _t(t)}successMapping(t,e=()=>null){return this.successMappingMap.set(t,e),this}failMapping(t,e=()=>null){return this.failMappingMap.set(t,e),this}errorMapping(t){return this.errorMappingFunction=t,this}authorizationHeader(t){return a.isBlank(t)||(this.authorization="Bearer "+t),this}connectionTimeout(t){this.connectionTimeoutValue=t}responseTimeout(t){this.responseTimeoutValue=t}async get(){const t=R.get(this.url,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization);return this.asTypeMappedPromise(t)}async post(t){const e=await R.post(this.url,t,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization);return this.asTypeMappedPromise(e)}async put(t){const e=await R.put(this.url,t,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization);return this.asTypeMappedPromise(e)}async patch(t){const e=await R.patch(this.url,t,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization);return this.asTypeMappedPromise(e)}async delete(t=null){const e=await R.delete(this.url,t,this.connectionTimeoutValue,this.responseTimeoutValue,this.authorization);return this.asTypeMappedPromise(e)}async asTypeMappedPromise(t){try{const e=await t;return await this.handleFetchResponse(e)}catch(t){throw this.errorMappingFunction(t)}}async handleFetchResponse(t){const e=this.successMappingMap.get(t.status),s=this.failMappingMap.get(t.status);if(204===t.status||"0"===t.headers.get("Content-Length")){if(e)return e(null);if(s)throw s(null);throw new Error("Missing mapper for return status: "+t.status)}try{const n=await t.json();if(e)return e(n);if(s)throw s(n);throw this.errorMappingFunction(n)}catch(t){throw this.errorMappingFunction(t)}}}const Bt=new l("AbstractValidator");class zt{constructor(t=!1,e=!0){this.validListenerList=new i,this.invalidListenerList=new i,this.currentlyValid=t,this.enabled=e}enable(){this.enabled=!0,this.isValid()?this.valid():this.invalid()}disable(){let t=this.currentlyValid;this.valid(),this.enabled=!1,this.currentlyValid=t}isValid(){return!this.enabled||this.currentlyValid}valid(){this.enabled&&(this.currentlyValid=!0,this.validListenerList?this.validListenerList.forEach(((t,e)=>(t.call(),!0)),this):Bt.warn("No validation listeners"))}invalid(){this.enabled&&(this.currentlyValid=!1,this.invalidListenerList?this.invalidListenerList.forEach(((t,e)=>(t.call(),!0)),this):Bt.warn("No invalidation listeners"))}validSilent(){this.currentlyValid=!0}invalidSilent(){this.currentlyValid=!1}withValidListener(t){return this.validListenerList.add(t),this}withInvalidListener(t){return this.invalidListenerList.add(t),this}}class Dt extends zt{constructor(t=!1){super(t),this.validatorList=new i}withValidator(t){return t.withValidListener(new u(this,this.oneValid)),t.withInvalidListener(new u(this,this.oneInvalid)),this.validatorList.add(t),this}oneValid(){let t=!1;this.validatorList.forEach(((e,s)=>!!e.isValid()||(t=!0,!1)),this),t?super.invalid():super.valid()}oneInvalid(){super.invalid()}}class jt extends zt{constructor(t=!1,e=!1,s="(.*)"){super(e),this.mandatory=t,this.regex=s}validate(t){t&&"string"==typeof t&&t.match(this.regex)?this.valid():t||this.mandatory?this.invalid():this.valid()}validateSilent(t){t&&"string"==typeof t&&t.match(this.regex)?this.validSilent():t||this.mandatory?this.invalidSilent():this.validSilent()}}class qt extends jt{static get EMAIL_FORMAT(){return/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/}constructor(t=!1,e=!1){super(t,e,qt.EMAIL_FORMAT)}}class Wt extends zt{constructor(t=!1,e=!1,s=null){super(e),this.mandatory=t,this.comparedValueFunction=s}validate(t){!t&&this.mandatory?this.invalid():t===this.comparedValueFunction.call()?this.valid():this.invalid()}validateSilent(t){!t&&this.mandatory?this.invalidSilent():t===this.comparedValueFunction.call()?this.validSilent():this.invalidSilent()}}class Xt extends zt{constructor(t=!1,e=!1,s=null,n=null){super(e),this.mandatory=t,this.model=s,this.attributeName=n}validate(t){!t&&this.mandatory?this.invalid():t===c.getValue(this.model,this.attributeName)?this.valid():this.invalid()}validateSilent(t){!t&&this.mandatory?this.invalidSilent():t===c.getValue(this.model,this.attributeName)?this.validSilent():this.invalidSilent()}}class Yt extends zt{constructor(t=!1,e=!1,s=null){super(e),this.mandatory=t,this.controlValue=s}validate(t){!t&&this.mandatory?this.invalid():t===controlValue?this.valid():this.invalid()}validateSilent(t){!t&&this.mandatory?this.invalidSilent():t===controlValue?this.validSilent():this.invalidSilent()}}class Qt extends jt{static get PHONE_FORMAT(){return/^\d*$/}constructor(t=!1,e=!1){super(t,e,Qt.PHONE_FORMAT)}}class $t extends zt{constructor(t=!1){super(t),this.validatorList=new i}withValidator(t){return t.withValidListener(new u(this,this.oneValid)),t.withInvalidListener(new u(this,this.oneInvalid)),this.validatorList.add(t),this}oneValid(){super.valid()}oneInvalid(){let t=!1;this.validatorList.forEach(((e,s)=>!e.isValid()||(t=!0,!1)),this),t?super.valid():super.invalid()}}const Jt=/^(?=.*[A-Za-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;class Gt extends jt{constructor(t=!1,e=!1){super(t,e,Jt)}}class Kt extends jt{static get PHONE_FORMAT(){return/^\+[0-9]{2}\s?([0-9]\s?)*$/}constructor(t=!1,e=!1){super(t,e,Kt.PHONE_FORMAT)}}class Zt extends zt{constructor(t=!1,e=!0){super(t,e)}validate(t){""===t?this.invalid():this.valid()}validateSilent(t){""===t?this.invalidSilent():this.validSilent()}}export{rt as AbstractInputElement,zt as AbstractValidator,N as ActiveModuleRunner,Dt as AndValidatorSet,Nt as Application,q as Attribute,$ as BaseElement,Ht as CSS,Et as CanvasRoot,St as CanvasStyles,lt as CheckboxInputElement,R as Client,wt as Component,z as ComponentConfigProcessor,Lt as ComponentFactory,j as ConfiguredFunction,it as DiModuleLoader,pt as ElementMapper,yt as ElementRegistrator,Y as ElementUtils,qt as EmailValidator,Wt as EqualsFunctionResultValidator,Xt as EqualsPropertyValidator,Yt as EqualsStringValidator,G as Event,Ot as EventFilteredMethod,It as EventManager,ht as FormElement,vt as HTML,S as History,_t as HttpCallBuilder,Rt as InputElementDataBinding,Z as LoaderInterceptor,W as MappedHtmlElement,st as Module,et as ModuleLoader,M as ModuleRunner,C as Navigation,Qt as NumberValidator,$t as OrValidatorSet,Gt as PasswordValidator,Kt as PhoneValidator,kt as ProxyObjectFactory,at as RadioInputElement,jt as RegexValidator,Zt as RequiredValidator,J as SimpleElement,mt as StateManager,Ft as Style,k as Styles,B as StylesLoader,U as StylesRegistry,I as Template,F as TemplateRegistry,_ as TemplatesLoader,ot as TextInputElement,ut as TextareaInputElement,ct as TextnodeElement,V as TrailNode,Vt as TrailProcessor,gt as UniqueIdRegistry,A as Url,x as UrlBuilder,T as UrlUtils,dt as VideoElement};
